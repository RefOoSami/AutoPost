<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Auto Post Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #1c1e21;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(108, 117, 125, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(173, 181, 189, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(206, 212, 218, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* Animated Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            background: rgba(108, 117, 125, 0.15);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        .particle:nth-child(1) {
            width: 4px;
            height: 4px;
            left: 10%;
            animation-delay: 0s;
            animation-duration: 8s;
        }

        .particle:nth-child(2) {
            width: 6px;
            height: 6px;
            left: 20%;
            animation-delay: 1s;
            animation-duration: 10s;
        }

        .particle:nth-child(3) {
            width: 3px;
            height: 3px;
            left: 30%;
            animation-delay: 2s;
            animation-duration: 7s;
        }

        .particle:nth-child(4) {
            width: 5px;
            height: 5px;
            left: 40%;
            animation-delay: 3s;
            animation-duration: 9s;
        }

        .particle:nth-child(5) {
            width: 4px;
            height: 4px;
            left: 50%;
            animation-delay: 4s;
            animation-duration: 6s;
        }

        .particle:nth-child(6) {
            width: 6px;
            height: 6px;
            left: 60%;
            animation-delay: 5s;
            animation-duration: 11s;
        }

        .particle:nth-child(7) {
            width: 3px;
            height: 3px;
            left: 70%;
            animation-delay: 6s;
            animation-duration: 8s;
        }

        .particle:nth-child(8) {
            width: 5px;
            height: 5px;
            left: 80%;
            animation-delay: 7s;
            animation-duration: 10s;
        }

        .particle:nth-child(9) {
            width: 4px;
            height: 4px;
            left: 90%;
            animation-delay: 8s;
            animation-duration: 7s;
        }

        .particle:nth-child(10) {
            width: 6px;
            height: 6px;
            left: 95%;
            animation-delay: 9s;
            animation-duration: 9s;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Floating Notification Styles */
        .floating-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 400px;
            border-radius: 12px;
            border: none;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            backdrop-filter: blur(10px);
            animation: slideInRight 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            font-weight: 500;
            font-size: 0.9rem;
            padding: 1rem 1.25rem;
        }

        .floating-notification.alert-success {
            background: linear-gradient(135deg, rgba(40, 167, 69, 0.95) 0%, rgba(32, 201, 151, 0.95) 100%);
            color: white;
            border-left: 4px solid #28a745;
        }

        .floating-notification.alert-error {
            background: linear-gradient(135deg, rgba(220, 53, 69, 0.95) 0%, rgba(255, 107, 107, 0.95) 100%);
            color: white;
            border-left: 4px solid #dc3545;
        }

        .floating-notification.alert-warning {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.95) 0%, rgba(255, 152, 0, 0.95) 100%);
            color: #212529;
            border-left: 4px solid #ffc107;
        }

        .floating-notification.alert-info {
            background: linear-gradient(135deg, rgba(24, 119, 242, 0.95) 0%, rgba(66, 165, 245, 0.95) 100%);
            color: white;
            border-left: 4px solid #1877f2;
        }

        .floating-notification.fade-out {
            animation: fadeOut 0.5s cubic-bezier(0.55, 0.055, 0.675, 0.19) forwards;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%) scale(0.8);
                opacity: 0;
            }
            to {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
            to {
                transform: translateX(100%) scale(0.8);
                opacity: 0;
            }
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 80px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: all 0.3s ease;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 1.5rem 0.5rem;
            background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%);
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .sidebar-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }

        .sidebar-header h3 {
            margin: 0;
            font-weight: 700;
            font-size: 1.2rem;
            position: relative;
            z-index: 1;
        }

        .user-info {
            margin-top: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .user-name {
            font-size: 0.7rem;
            color: white;
            text-align: center;
            font-weight: 500;
            line-height: 1.2;
            max-width: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .sidebar-nav {
            z-index: 999;
            padding: 1rem 0;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 120px);
        }

        .nav-item.mt-auto {
            margin-top: auto;
        }

        .nav-item {
            margin: 0.5rem 0.75rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            color: #1c1e21;
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
            width: 48px;
            height: 48px;
            margin: 0 auto;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .nav-link:hover::before {
            left: 100%;
        }

        .nav-link:hover {
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
            color: #1877f2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.15);
        }

        .nav-link.active {
            background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(24, 119, 242, 0.3);
        }

        .nav-link.active::before {
            display: none;
        }

        .nav-link i {
            font-size: 1.4rem;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            margin-left: 80px;
            min-height: 100vh;
            padding: 2rem;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Group Management Styles */
        .group-category {
            background: #fff;
            border: 2px solid #e4e6eb;
            border-radius: 16px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .group-category:hover {
            border-color: #1877f2;
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.1);
            transform: translateY(-2px);
        }

        .group-category.expanded {
            border-color: #1877f2;
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        }

        .category-info {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #1c1e21;
        }

        .category-name {
            font-size: 1.1rem;
            margin-right: 0.5rem;
        }

        .category-count {
            color: #65676b;
            font-weight: 400;
            font-size: 0.9rem;
        }

        .category-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .category-arrow {
            color: #65676b;
            transition: transform 0.3s ease;
        }

        .group-category.expanded .category-arrow {
            transform: rotate(180deg);
            color: #1877f2;
        }

        .category-content {
            padding: 0 1.5rem 1.5rem;
            display: none;
        }

        .group-category.expanded .category-content {
            display: block;
        }

        .add-group-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e4e6eb;
        }

        .add-group-section .floating-label {
            margin-bottom: 0;
        }

        .add-group-section .form-control {
            border-radius: 8px;
            border: 2px solid #e4e6eb;
            transition: all 0.3s ease;
        }

        .add-group-section .form-control:focus {
            border-color: #1877f2;
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
        }

        .add-group-section .btn {
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .add-group-section .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.2);
        }

        .group-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            padding: 0.5rem;
        }

        .group-tag {
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
            border: 1px solid #1877f2;
            color: #1877f2;
            padding: 1rem;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            height: 80px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .group-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.2);
            background: linear-gradient(135deg, #d1e7ff 0%, #e7f3ff 100%);
        }

        .group-tag .remove-group {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .group-tag .remove-group:hover {
            background: #dc3545;
            color: white;
            transform: scale(1.1);
        }

        .add-category-btn {
            background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%);
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            font-weight: 600;
            font-size: 1.1rem;
            color: white;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .add-category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(24, 119, 242, 0.3);
        }

        .add-category-btn:active {
            transform: translateY(0);
        }

        /* Category Selection Styles */
        .category-selection-card {
            background: #fff;
            border: 2px solid #e4e6eb;
            border-radius: 16px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .category-selection-card:hover {
            border-color: #1877f2;
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.1);
            transform: translateY(-2px);
        }

        .category-selection-card.selected {
            border-color: #1877f2;
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
        }

        .category-selection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        }

        .category-selection-checkbox {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .category-selection-checkbox .form-check-input {
            width: 20px;
            height: 20px;
            border: 2px solid #1877f2;
            border-radius: 4px;
            cursor: pointer;
        }

        .category-selection-checkbox .form-check-input:checked {
            background-color: #1877f2;
            border-color: #1877f2;
        }

        .category-selection-checkbox .form-check-label {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #1c1e21;
            cursor: pointer;
        }

        .category-title {
            font-size: 1.1rem;
            margin-right: 0.5rem;
        }

        .category-count {
            color: #65676b;
            font-weight: 400;
            font-size: 0.9rem;
        }

        .category-selection-arrow {
            color: #65676b;
            transition: transform 0.3s ease;
        }

        .category-selection-card.selected .category-selection-arrow {
            transform: rotate(180deg);
            color: #1877f2;
        }

        .category-selection-content {
            padding: 0 1.5rem 1.5rem;
            display: none;
        }

        .category-selection-card.selected .category-selection-content {
            display: block;
        }

        /* Form improvements */
        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #fff;
            border-radius: 16px;
            border: 1px solid #e4e6eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .floating-label select {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e4e6eb;
            border-radius: 12px;
            font-size: 1rem;
            background: #fff;
            transition: all 0.3s ease;
        }

        .floating-label select:focus {
            border-color: #1877f2;
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
            outline: none;
        }

        .group-tag {
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
            border: 1px solid #1877f2;
            color: #1877f2;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.25rem;
        }



        .group-tag .group-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #1877f2;
        }

        .group-tag .group-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            flex: 1;
        }

        .group-tag .group-name {
            font-weight: 600;
            color: #1877f2;
            font-size: 0.95rem;
        }

        /* Account Management Styles */
        .account-card {
            background: #fff;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e4e6eb;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .account-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .account-card.selected {
            border-color: #1877f2;
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
            box-shadow: 0 8px 24px rgba(24, 119, 242, 0.2);
        }

        .account-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .account-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #1877f2;
        }

        .account-info {
            flex: 1;
        }

        .account-name {
            font-weight: 600;
            color: #1c1e21;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .account-id {
            font-size: 0.9rem;
            color: #65676b;
        }

        .account-actions {
            display: flex;
            gap: 0.5rem;
        }



        .remove-account-btn {
            background: none;
            border: 1px solid #dc3545;
            color: #dc3545;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .remove-account-btn:hover {
            background: #dc3545;
            color: white;
        }

        /* Mobile Responsive */
        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%);
            border: none;
            color: white;
            padding: 1rem;
            border-radius: 12px;
            font-size: 1.2rem;
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.3);
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(24, 119, 242, 0.4);
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 80px;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .sidebar-toggle {
                display: block;
            }
        }

        /* Existing styles... */
        .main-container {
            min-height: 100vh;
            padding: 2rem 0;
        }

        .card {
            border: none;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(15px);
            background: rgba(255, 255, 255, 0.95);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card-header {
            background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%);
            border: none;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .card-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }

        .card-header h3 {
            position: relative;
            z-index: 1;
            font-weight: 700;
            font-size: 2rem;
            margin: 0;
        }

        .card-body {
            padding: 3rem;
        }

        .form-label {
            font-weight: 600;
            color: #1c1e21;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .form-control,
        .form-select {
            border: 2px solid #e4e6eb;
            border-radius: 12px;
            padding: 1rem 1.25rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: #1877f2;
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
            background: #fff;
        }

        .form-control::placeholder {
            color: #65676b;
        }

        .upload-area {
            border: 3px dashed #1877f2;
            border-radius: 16px;
            padding: 3rem 2rem;
            text-align: center;
            background: linear-gradient(135deg, #f0f2f5 0%, #e4e6eb 100%);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover {
            border-color: #42a5f5;
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
            transform: translateY(-2px);
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .upload-area:hover::before {
            left: 100%;
        }

        .upload-icon {
            font-size: 3rem;
            color: #1877f2;
            margin-bottom: 1rem;
        }

        .image-preview-container {
            background: #fff;
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e4e6eb;
            transition: all 0.3s ease;
        }

        .image-preview-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .image-preview {
            width: 100%;
            max-width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .image-preview-wrapper {
            position: relative;
            display: inline-block;
        }

        .image-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .image-preview-wrapper:hover .image-actions {
            opacity: 1;
        }

        .remove-image-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            padding: 0;
        }

        .drag-handle {
            width: 28px;
            height: 28px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            color: #65676b;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .drag-handle:hover {
            background: rgba(255, 255, 255, 1);
            color: #1877f2;
            transform: scale(1.1);
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .image-order-badge {
            position: absolute;
            bottom: 8px;
            left: 8px;
            background: rgba(24, 119, 242, 0.9);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        .image-preview-container.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
            z-index: 1000;
        }

        .image-preview-container.drag-over {
            border: 2px dashed #1877f2;
            background: rgba(24, 119, 242, 0.05);
        }

        .image-preview-container {
            cursor: grab;
        }

        .image-preview-container:active {
            cursor: grabbing;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%);
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(24, 119, 242, 0.3);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .loading {
            display: none;
            padding: 2rem;
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
        }

        .alert {
            border: none;
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            margin-top: 1.5rem;
            font-weight: 500;
        }

        .alert-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
        }

        .alert-danger {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1c1e21;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-title i {
            color: #1877f2;
            font-size: 1.5rem;
        }

        .progress-bar {
            height: 4px;
            background: #e4e6eb;
            border-radius: 2px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #1877f2, #42a5f5);
            width: 0%;
            transition: width 0.3s ease;
        }

        .floating-label {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .floating-label input,
        .floating-label textarea {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e4e6eb;
            border-radius: 12px;
            font-size: 1rem;
            background: #fff;
            transition: all 0.3s ease;
        }

        .floating-label input:focus,
        .floating-label textarea:focus {
            border-color: #1877f2;
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
            outline: none;
        }

        .floating-label label {
            position: absolute;
            left: 1.25rem;
            top: 1rem;
            color: #65676b;
            transition: all 0.3s ease;
            pointer-events: none;
            font-size: 1rem;
        }

        .floating-label input:focus+label,
        .floating-label textarea:focus+label,
        .floating-label input:not(:placeholder-shown)+label,
        .floating-label textarea:not(:placeholder-shown)+label {
            top: 0.5rem;
            font-size: 0.8rem;
            color: #1877f2;
            font-weight: 600;
        }

        .help-text {
            font-size: 0.875rem;
            color: #65676b;
            margin-top: 0.5rem;
            line-height: 1.4;
        }

        .cookie-instructions {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 1px solid #ffeaa7;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .cookie-instructions ol {
            margin: 0;
            padding-left: 1.5rem;
        }

        .cookie-instructions li {
            margin-bottom: 0.5rem;
            color: #856404;
        }

        .group-input-container {
            position: relative;
            transition: all 0.3s ease;
        }

        .group-input-container:hover {
            transform: translateY(-1px);
        }

        .btn-outline-primary {
            border-color: #1877f2;
            color: #1877f2;
            transition: all 0.3s ease;
        }

        .btn-outline-primary:hover {
            background-color: #1877f2;
            border-color: #1877f2;
            color: white;
            transform: translateY(-1px);
        }

        .btn-outline-danger {
            border-color: #dc3545;
            color: #dc3545;
            transition: all 0.3s ease;
        }

        .btn-outline-danger:hover {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @media (max-width: 768px) {
            .card-body {
                padding: 2rem 1.5rem;
            }

            .form-section {
                padding: 1.5rem;
            }

            .card-header {
                padding: 1.5rem;
            }

            .card-header h3 {
                font-size: 1.5rem;
            }
        }

        /* Poster Management Styles */
        .poster-card {
            background: #fff;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e4e6eb;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .poster-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .poster-card.selected {
            border-color: #1877f2;
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
            box-shadow: 0 8px 24px rgba(24, 119, 242, 0.2);
        }

        .poster-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .poster-info {
            flex: 1;
        }

        .poster-name {
            font-weight: 600;
            color: #1c1e21;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .poster-caption {
            color: #65676b;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .poster-actions {
            display: flex;
            gap: 0.5rem;
        }

        .edit-poster-btn {
            background: none;
            border: 1px solid #17a2b8;
            color: #17a2b8;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .edit-poster-btn:hover {
            background: #17a2b8;
            color: white;
        }

        .remove-poster-btn {
            background: none;
            border: 1px solid #dc3545;
            color: #dc3545;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .remove-poster-btn:hover {
            background: #dc3545;
            color: white;
        }

        .poster-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
        }

        .poster-image-item {
            text-align: center;
        }

        .poster-thumbnail {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e4e6eb;
            margin-bottom: 0.5rem;
        }

        .image-caption {
            font-size: 0.8rem;
            color: #65676b;
            line-height: 1.2;
            word-break: break-word;
        }

        /* Modern Scheduled Posts Styles */
        .scheduled-posts-container {
            display: grid;
            gap: 1.5rem;
        }

        .post-card {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .post-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.12);
        }

        .post-card.scheduled {
            border-left: 6px solid #ffc107;
            background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
        }

        .post-card.published {
            border-left: 6px solid #28a745;
            background: linear-gradient(135deg, #e8f5e8 0%, #ffffff 100%);
        }

        .post-card.partial {
            border-left: 6px solid #fd7e14;
            background: linear-gradient(135deg, #fff3e0 0%, #ffffff 100%);
        }

        .post-card.failed {
            border-left: 6px solid #dc3545;
            background: linear-gradient(135deg, #ffeaea 0%, #ffffff 100%);
        }

        .post-card.unknown {
            border-left: 6px solid #6c757d;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        }

        .post-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .post-info {
            flex: 1;
        }

        .post-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1c1e21;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .post-title i {
            font-size: 1.1rem;
            opacity: 0.7;
        }

        .post-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #65676b;
            background: rgba(0, 0, 0, 0.03);
            padding: 0.5rem 0.75rem;
            border-radius: 12px;
            font-weight: 500;
        }

        .meta-item i {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .post-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-badge.scheduled {
            background: linear-gradient(135deg, #ffc107 0%, #ffb300 100%);
            color: #000;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }

        .status-badge.published {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: #fff;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .status-badge.partial {
            background: linear-gradient(135deg, #fd7e14 0%, #ff8c00 100%);
            color: #fff;
            box-shadow: 0 4px 12px rgba(253, 126, 20, 0.3);
        }

        .status-badge.failed {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: #fff;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .status-badge.unknown {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            color: #fff;
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        .post-body {
            padding: 1.5rem 2rem;
        }

        .post-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .detail-item {
            background: rgba(0, 0, 0, 0.02);
            padding: 1rem;
            border-radius: 12px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .detail-label {
            font-size: 0.75rem;
            color: #65676b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .detail-value {
            font-size: 0.9rem;
            color: #1c1e21;
            font-weight: 500;
        }

        .post-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }

        .action-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border: none;
            cursor: pointer;
        }

        .action-btn.cancel {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: #fff;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.2);
        }

        .action-btn.cancel:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(220, 53, 69, 0.3);
        }

        .result-info {
            background: rgba(0, 0, 0, 0.03);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            border-left: 4px solid #1877f2;
        }

        .result-info.success {
            background: rgba(40, 167, 69, 0.05);
            border-left-color: #28a745;
        }

        .result-info.error {
            background: rgba(220, 53, 69, 0.05);
            border-left-color: #dc3545;
        }

        .result-info.warning {
            background: rgba(255, 193, 7, 0.05);
            border-left-color: #ffc107;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #65676b;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-state h4 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: #1c1e21;
        }

        .empty-state p {
            font-size: 1rem;
            opacity: 0.7;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .post-header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .post-body {
                padding: 1rem;
            }

            .post-details {
                grid-template-columns: 1fr;
            }

            .post-actions {
                flex-direction: column;
            }

            .post-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
        }

        /* Available Groups Styles */
        .available-groups-list {
            max-height: 500px;
            overflow-y: auto;
            border: 2px solid #e4e6eb;
            border-radius: 12px;
            background: #f8f9fa;
            padding: 0.5rem;
        }

        .available-group-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 1px solid #e4e6eb;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            background: white;
        }

        .available-group-item:last-child {
            margin-bottom: 0;
        }

        .available-group-item:hover {
            background: #e7f3ff;
            border-color: #1877f2;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(24, 119, 242, 0.1);
        }

        .available-group-item.selected {
            background: #1877f2;
            color: white;
            border-color: #1877f2;
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.3);
        }

        .available-group-item.selected .available-group-name,
        .available-group-item.selected .available-group-url {
            color: white;
        }

        .available-group-item.selected .available-group-url {
            opacity: 0.8;
        }

        .available-group-avatar {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            margin-right: 1rem;
            object-fit: cover;
        }

        .available-group-info {
            flex: 1;
        }

        .available-group-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .available-group-url {
            font-size: 0.875rem;
            opacity: 0.7;
            word-break: break-all;
        }

        .available-group-actions {
            display: flex;
            gap: 0.5rem;
        }

        .group-category-selector {
            margin-top: 1rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            border: 2px solid #1877f2;
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.1);
        }

        .group-category-selector h6 {
            margin-bottom: 1rem;
            color: #1c1e21;
            font-weight: 600;
        }

        .group-category-selector .form-select {
            margin-bottom: 1rem;
            border: 2px solid #e4e6eb;
            border-radius: 8px;
            padding: 0.75rem;
        }

        .group-category-selector .form-select:focus {
            border-color: #1877f2;
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
        }

        .group-category-selector .btn {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 600;
        }

        .group-selection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%);
            border-radius: 12px;
            color: white;
        }

        .group-selection-header h5 {
            margin: 0;
            font-weight: 600;
        }

        .group-selection-actions {
            display: flex;
            gap: 0.5rem;
        }

        .group-selection-actions .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .selected-groups-summary {
            background: #e7f3ff;
            border: 1px solid #1877f2;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .selected-groups-summary h6 {
            color: #1877f2;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .selected-groups-count {
            font-size: 0.875rem;
            color: #65676b;
        }

        /* Category Group Loader Styles */
        .group-loader-section {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            border: 1px solid #e4e6eb;
        }

        .group-loader-header h6 {
            color: #1c1e21;
            margin-bottom: 1rem;
            font-weight: 600;
        }



        .category-groups-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            max-height: 300px;
            overflow-y: auto;
            padding: 0.5rem;
            scrollbar-width: thin;
            scrollbar-color: #1877f2 #f0f2f5;
        }

        .category-groups-grid::-webkit-scrollbar {
            width: 6px;
        }

        .category-groups-grid::-webkit-scrollbar-track {
            background: #f0f2f5;
            border-radius: 3px;
        }

        .category-groups-grid::-webkit-scrollbar-thumb {
            background: #1877f2;
            border-radius: 3px;
        }

        .category-groups-grid::-webkit-scrollbar-thumb:hover {
            background: #1565c0;
        }

        .category-group-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 1px solid #e4e6eb;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: white;
            height: 80px;
        }

        .category-group-item:hover {
            background: #f8f9fa;
            border-color: #1877f2;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(24, 119, 242, 0.1);
        }

        .category-group-item.selected {
            background: #1877f2;
            color: white;
            border-color: #1877f2;
            box-shadow: 0 2px 8px rgba(24, 119, 242, 0.2);
        }

        .category-group-item.selected .category-group-name,
        .category-group-item.selected .category-group-url {
            color: white;
        }

        .category-group-item.selected .category-group-url {
            opacity: 0.8;
        }

        .category-group-avatar {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            margin-right: 0.75rem;
            object-fit: cover;
        }

        .category-group-info {
            flex: 1;
        }

        .category-group-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        /* Footer Styles */
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 249, 250, 0.95) 100%);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(228, 230, 235, 0.5);
            padding: 0.75rem 0;
            z-index: 200;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        }

        .footer-content {
            text-align: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .footer-text {
            font-size: 0.875rem;
            color: #65676b;
            font-weight: 500;
            letter-spacing: 0.5px;
            transition: color 0.3s ease;
        }

        .footer-text:hover {
            color: #1877f2;
        }

        /* Adjust main content to account for footer */
        .main-content {
            padding-bottom: 4rem;
        }

        /* Welcome Section Styles */
        .welcome-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            border: 1px solid #e4e6eb;
            margin: 2rem 0;
        }

        .welcome-header {
            margin-bottom: 3rem;
        }

        .welcome-icon {
            font-size: 3rem;
            color: #1877f2;
            margin-bottom: 1.5rem;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1c1e21;
            margin-bottom: 1rem;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            color: #65676b;
            margin-bottom: 0;
        }

        .welcome-features {
            margin-bottom: 3rem;
        }

        .feature-card {
            background: white;
            border: 2px solid #e4e6eb;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            height: 100%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: #1877f2;
            box-shadow: 0 8px 25px rgba(24, 119, 242, 0.15);
        }

        .feature-icon {
            font-size: 2.5rem;
            color: #1877f2;
            margin-bottom: 1rem;
        }

        .feature-card h5 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1c1e21;
            margin-bottom: 0.75rem;
        }

        .feature-card p {
            font-size: 0.9rem;
            color: #65676b;
            margin: 0;
            line-height: 1.5;
        }

        .welcome-footer {
            border-top: 1px solid #e4e6eb;
            padding-top: 2rem;
        }

        .welcome-instruction {
            font-size: 1rem;
            color: #65676b;
            margin-bottom: 1.5rem;
        }

        .welcome-stats {
            display: flex;
            justify-content: center;
            gap: 3rem;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1877f2;
            display: block;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #65676b;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 0.25rem;
        }

        /* Account Selection Styles */
        .account-selection-section {
            background: linear-gradient(135deg, #f0f2f5 0%, #e4e6eb 100%);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #e4e6eb;
        }

        .account-selection-section h5 {
            color: #1c1e21;
            margin-bottom: 1rem;
        }

        /* Existing styles... */
    </style>
</head>

<body>
    <!-- Animated Particles -->
    <div class="particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Sidebar Toggle for Mobile -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            {% if user %}
            <div class="user-info">
                <img src="{{ user.user_picture }}" alt="Profile" class="user-avatar" onerror="this.src='https://via.placeholder.com/32x32/1877f2/ffffff?text=U'">
                <span class="user-name">{{ user.user_name }}</span>
            </div>
            {% endif %}
        </div>
        <nav class="sidebar-nav">
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('accounts', event)" title="Account Management">
                    <i class="fas fa-user-circle"></i>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('groups', event)" title="Group Management">
                    <i class="fas fa-users"></i>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('posters', event)" title="Poster Management">
                    <i class="fas fa-image"></i>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('post', event)" title="Create Post">
                    <i class="fas fa-paper-plane"></i>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('scheduled', event)" title="Scheduled & History">
                    <i class="fas fa-clock"></i>
                </a>
            </div>
            <div class="nav-item mt-auto">
                <a href="{{ url_for('logout') }}" class="nav-link" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </a>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Welcome Section -->
        <div id="welcome-section" class="content-section active">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10 col-xl-8">
                        <div class="welcome-card">
                            <div class="welcome-header text-center">
                                <div class="welcome-icon">
                                    <i class="fas fa-rocket"></i>
                                </div>
                                <h2 class="welcome-title">Welcome to Facebook Auto Post</h2>
                                <p class="welcome-subtitle">Your complete solution for managing Facebook content</p>
                            </div>
                            
                            <div class="welcome-features">
                                <div class="row">
                                    <div class="col-md-6 col-lg-4 mb-4">
                                        <div class="feature-card">
                                            <div class="feature-icon">
                                                <i class="fas fa-user-circle"></i>
                                            </div>
                                            <h5>Account Management</h5>
                                            <p>Add and manage your Facebook accounts securely</p>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4 mb-4">
                                        <div class="feature-card">
                                            <div class="feature-icon">
                                                <i class="fas fa-users"></i>
                                            </div>
                                            <h5>Group Management</h5>
                                            <p>Organize your Facebook groups into categories</p>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4 mb-4">
                                        <div class="feature-card">
                                            <div class="feature-icon">
                                                <i class="fas fa-image"></i>
                                            </div>
                                            <h5>Poster Management</h5>
                                            <p>Create and save reusable post content</p>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4 mb-4">
                                        <div class="feature-card">
                                            <div class="feature-icon">
                                                <i class="fas fa-paper-plane"></i>
                                            </div>
                                            <h5>Create Posts</h5>
                                            <p>Schedule and publish posts to multiple groups</p>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4 mb-4">
                                        <div class="feature-card">
                                            <div class="feature-icon">
                                                <i class="fas fa-clock"></i>
                                            </div>
                                            <h5>Scheduled Posts</h5>
                                            <p>View your scheduled posts and history</p>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-lg-4 mb-4">
                                        <div class="feature-card">
                                            <div class="feature-icon">
                                                <i class="fas fa-chart-line"></i>
                                            </div>
                                            <h5>Analytics</h5>
                                            <p>Track your posting performance and success</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="welcome-footer text-center">
                                <p class="welcome-instruction">Use the sidebar navigation to get started</p>
                                <div class="welcome-stats">
                                    <div class="stat-item">
                                        <div class="stat-number">100%</div>
                                        <div class="stat-label">Secure</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">24/7</div>
                                        <div class="stat-label">Available</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-number">∞</div>
                                        <div class="stat-label">Groups</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Post Creation Section -->
        <div id="post-section" class="content-section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10 col-xl-8">
                        <div class="card fade-in-up">
                            <div class="card-header">
                                <h3 class="text-white">
                                    <i class="fas fa-paper-plane"></i> Create New Post
                                </h3>
                                <p class="text-white-50 mb-0 mt-2">Create and schedule posts with images and captions
                                </p>
                            </div>
                            <div class="card-body">
                                {% with messages = get_flashed_messages(with_categories=true) %}
                                {% if messages %}
                                {% for category, message in messages %}
                                <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show"
                                    role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                                {% endfor %}
                                {% endif %}
                                {% endwith %}

                                <form id="postForm" enctype="multipart/form-data">
                                    <!-- Account Selection Section -->
                                    <div class="form-section">
                                        <div class="section-title">
                                            <i class="fas fa-user-circle"></i>
                                            Select Account
                                        </div>
                                        <div id="selectedAccountContainer">
                                            <div class="alert alert-info">
                                                <i class="fas fa-info-circle me-2"></i>
                                                No account selected. Please select an account below.
                                            </div>
                                        </div>
                                        <div id="accountSelectorContent">
                                            <!-- Accounts will be loaded here -->
                                        </div>
                                    </div>

                                    <!-- Group Selection Section -->
                                    <div class="form-section">
                                        <div class="section-title">
                                            <i class="fas fa-users"></i>
                                            Select Groups
                                        </div>
                                        <div id="groupSelectorContent">
                                            <!-- Categories will be loaded here -->
                                            </div>
                                    </div>

                                    <!-- Poster Selection Section -->
                                    <div class="form-section">
                                        <div class="section-title">
                                            <i class="fas fa-image"></i>
                                            Select Poster
                                        </div>
                                        <div id="selectedPosterContainer">
                                            <div class="alert alert-info">
                                                <i class="fas fa-info-circle me-2"></i>
                                                Please select a poster to create your post. You can create posters in Poster Management.
                                        </div>
                                        </div>
                                        <div id="posterSelectorContent">
                                            <!-- Posters will be loaded here -->
                                        </div>
                                    </div>

                                    <!-- Date/Time Picker Section -->
                                    <div class="form-section">
                                        <div class="section-title">
                                            <i class="fas fa-calendar-alt"></i>
                                            Schedule Date & Time (optional)
                                        </div>
                                        <input type="datetime-local" id="scheduledDateTime" name="scheduledDateTime" class="form-control">

                                    </div>

                                    <!-- Submit Section -->
                                    <div class="text-center">
                                        <button type="button" class="btn btn-primary btn-lg pulse" id="scheduleBtn">
                                            <i class="fas fa-clock me-2"></i>
                                            Schedule Post
                                        </button>
                                        <div class="loading text-center" id="loading">
                                            <div class="spinner-border text-primary mb-3" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <h5>Scheduling your post...</h5>
                                            <p class="text-muted">Please wait while we prepare your scheduled post</p>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Group Management Section -->
        <div id="groups-section" class="content-section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10 col-xl-8">
                        <div class="card fade-in-up">
                            <div class="card-header">
                                <h3 class="text-white">
                                    <i class="fas fa-users"></i> Group Management
                                </h3>
                                <p class="text-white-50 mb-0 mt-2">Organize and manage your Facebook groups</p>
                            </div>
                            <div class="card-body">
                                <!-- Categories Container -->
                                <div id="categoriesContainer">
                                    <!-- Categories will be loaded here -->
                                </div>

                                <!-- Add Category Button -->
                                <button type="button" class="btn add-category-btn" onclick="addCategory()">
                                    <i class="fas fa-plus me-2"></i>Add New Category
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Poster Management Section -->
        <div id="posters-section" class="content-section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10 col-xl-8">
                        <div class="card fade-in-up">
                            <div class="card-header">
                                <h3 class="text-white">
                                    <i class="fas fa-image"></i> Poster Management
                                </h3>
                                <p class="text-white-50 mb-0 mt-2">Create and manage your saved posters</p>
                            </div>
                            <div class="card-body">
                                <!-- Posters Container -->
                                <div id="postersContainer">
                                    <!-- Posters will be loaded here -->
                                </div>

                                <!-- Add Poster Section -->
                                <div class="form-section">
                                    <div class="section-title">
                                        <i class="fas fa-plus-circle"></i>
                                        Create New Poster
                                    </div>
                                    <form id="posterForm">
                                    <div class="row">
                                            <div class="col-md-12">
                                            <div class="floating-label">
                                                    <input type="text" id="posterName" name="posterName" placeholder=" " required>
                                                    <label for="posterName">Poster Name</label>
                                            </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                            <div class="floating-label">
                                                    <textarea id="posterCaption" name="posterCaption" rows="4" placeholder=" " required></textarea>
                                                    <label for="posterCaption">Main Caption</label>
                                            </div>
                                        </div>
                                    </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="upload-area" onclick="document.getElementById('posterImages').click()">
                                                    <div class="upload-icon">
                                                        <i class="fas fa-cloud-upload-alt"></i>
                                    </div>
                                                    <h5 class="mb-2">Upload Images</h5>
                                                    <p class="text-muted mb-0">Click to select or drag and drop images here</p>
                                                    <p class="text-muted small mt-2">Supports: PNG, JPG, JPEG, GIF, BMP</p>
                                </div>
                                                <input type="file" class="d-none" id="posterImages" name="posterImages" multiple accept="image/*" onchange="handlePosterImageUpload()">
                                            </div>
                                        </div>
                                        <!-- Poster Image Previews -->
                                        <div id="posterImagePreviews" class="mt-4"></div>
                                        

                                    <div class="text-center mt-3">
                                        <button type="submit" class="btn btn-primary" id="savePosterBtn">
                                            <i class="fas fa-save me-2"></i>Save Poster
                                        </button>
                                    </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Management Section -->
        <div id="accounts-section" class="content-section active">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10 col-xl-8">
                        <div class="card fade-in-up">
                            <div class="card-header">
                                <h3 class="text-white">
                                    <i class="fas fa-user-circle"></i> Account Management
                                </h3>
                                <p class="text-white-50 mb-0 mt-2">Manage your Facebook accounts</p>
                            </div>
                            <div class="card-body">
                                <!-- Accounts Container -->
                                <div id="accountsContainer">
                                    <!-- Accounts will be loaded here -->
                                </div>

                                <!-- Add Account Section -->
                                <div class="form-section">
                                    <div class="section-title">
                                        <i class="fas fa-plus-circle"></i>
                                        Add New Account
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="floating-label">
                                                <textarea id="newAccountCookies" rows="6" placeholder=" "
                                                    required></textarea>
                                                <label for="newAccountCookies">Facebook Cookies</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-center mt-3">
                                        <button type="button" class="btn btn-primary" onclick="fetchAndAddAccount()">
                                            <i class="fas fa-search me-2"></i>Fetch & Add Account
                                        </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <!-- Scheduled Posts & History Section -->
        <div id="scheduled-section" class="content-section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10 col-xl-8">
                        <div class="card fade-in-up">
                            <div class="card-header">
                                <h3 class="text-white">
                                    <i class="fas fa-clock"></i> Scheduled & History
                                </h3>
                                <p class="text-white-50 mb-0 mt-2">View your upcoming scheduled posts and post history</p>
                </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-end mb-3">
                                    <button class="btn btn-danger" onclick="clearAllHistory()">
                                        <i class="fas fa-trash me-2"></i>Clear History
                                    </button>
                    </div>
                                <div id="scheduledPostsContainer" class="scheduled-posts-container">
                                    <!-- Scheduled and published posts will be loaded here -->
                </div>
                </div>
            </div>
        </div>
    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <span class="footer-text">Made with ❤️ by Raafat Sami</span>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Navigation functions
        function showSection(section, event = null) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));

            // Show selected section
            document.getElementById(section + '-section').classList.add('active');
            
            // Only update nav-link if event is provided
            if (event && event.target) {
            event.target.classList.add('active');
            }

            // Load data for the section
            if (section === 'welcome') {
                // Welcome section doesn't need data loading
            } else if (section === 'groups') {
                loadGroups();
            } else if (section === 'accounts') {
                loadAccounts();
            } else if (section === 'posters') {
                loadPosters();
            } else if (section === 'post') {
                loadPostSelectors();
            } else if (section === 'scheduled') {
                loadScheduledPosts();
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // Group Management Functions
        let categories = [];
        let selectedGroups = [];
        let availableGroups = [];

        // Account Management Functions
        let accounts = [];
        let selectedAccount = null;

        // Poster Management Functions
        let posters = [];
        let selectedPoster = null;

        function loadAccounts() {
            const container = document.getElementById('accountsContainer');
            
            if (!container) {
                return;
            }
            
            if (accounts.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No accounts added yet. Add your first Facebook account above.
                    </div>
                `;
                return;
            }

            const htmlContent = accounts.map((account, index) => `
                <div class="account-card">
                    <div class="account-header">
                        <img src="${account.profile_pic_url || 'https://via.placeholder.com/60x60/1877f2/ffffff?text=FB'}" 
                             alt="Profile" class="account-avatar" 
                             onerror="this.src='https://via.placeholder.com/60x60/1877f2/ffffff?text=FB'">
                        <div class="account-info">
                            <div class="account-name">${account.account_name}</div>
                            <div class="account-id">ID: ${account.user_id}</div>
                        </div>
                        <div class="account-actions">
                            <button class="remove-account-btn" onclick="removeAccount(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = htmlContent;
        }

        function loadGroups() {
            // Load categories from MongoDB
            loadCategoriesFromMongoDB();
        }

        function populateAllCategoryAccountSelectors() {
            categories.forEach((category, index) => {
                const accountSelect = document.getElementById(`categoryAccountSelect-${index}`);
                if (accountSelect) {
                    accountSelect.innerHTML = '<option value="">Select an account...</option>';
                    accounts.forEach(account => {
                        accountSelect.innerHTML += `<option value="${account.user_id}">${account.account_name}</option>`;
                    });
                }
            });
        }

        function loadGroupsForCategory(categoryIndex) {
            const accountId = document.getElementById(`categoryAccountSelect-${categoryIndex}`).value;
            
            if (!accountId) {
                showFloatingNotification('Please select an account first', 'error');
                return;
            }

            // Show loading status
            document.getElementById(`categoryLoadingStatus-${categoryIndex}`).classList.remove('d-none');
            document.getElementById(`categoryGroupsContainer-${categoryIndex}`).classList.add('d-none');

            fetch('/fetch_account_groups', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    account_id: accountId
                })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById(`categoryLoadingStatus-${categoryIndex}`).classList.add('d-none');
                
                if (data.success) {
                    displayCategoryGroups(categoryIndex, data.groups);
                    showFloatingNotification(`Loaded ${data.total_groups} groups successfully!`, 'success');
                } else {
                    showFloatingNotification('Error loading groups: ' + data.error, 'error');
                }
            })
            .catch(error => {
                document.getElementById(`categoryLoadingStatus-${categoryIndex}`).classList.add('d-none');
                showFloatingNotification('Error loading groups: ' + error.message, 'error');
            });
        }

        function displayCategoryGroups(categoryIndex, groups) {
            const container = document.getElementById(`categoryGroupsList-${categoryIndex}`);
            const groupsContainer = document.getElementById(`categoryGroupsContainer-${categoryIndex}`);
            
            if (!container || !groupsContainer) return;
            
            // Store groups data for this category
            categoryGroupsData[categoryIndex] = groups;
            
            if (groups.length === 0) {
                container.innerHTML = `
                    <div class="text-center p-3">
                        <i class="fas fa-info-circle text-muted" style="font-size: 1.5rem;"></i>
                        <p class="mt-2 text-muted small">No groups found for this account.</p>
                    </div>
                `;
            } else {
                const groupsHtml = groups.map((group, index) => `
                    <div class="category-group-item" onclick="toggleCategoryGroupSelection(${categoryIndex}, ${index})" data-category-group-index="${index}">
                        <div class="form-check me-2 d-none">
                            <input class="form-check-input" type="checkbox" id="category-group-${categoryIndex}-${index}" 
                                   onchange="updateCategoryGroupSelection(${categoryIndex}, ${index}, this.checked)">
                        </div>
                        <img src="${group.image_url || 'https://via.placeholder.com/40x40/1877f2/ffffff?text=G'}" 
                             alt="Group" class="category-group-avatar" 
                             onerror="this.src='https://via.placeholder.com/40x40/1877f2/ffffff?text=G'">
                        <div class="category-group-info">
                            <div class="category-group-name">${group.name}</div>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = groupsHtml;
            }
            
            groupsContainer.classList.remove('d-none');
        }

        // Store category groups data
        let categoryGroupsData = {};

        function toggleCategoryGroupSelection(categoryIndex, groupIndex) {
            const checkbox = document.getElementById(`category-group-${categoryIndex}-${groupIndex}`);
            if (checkbox) {
                checkbox.checked = !checkbox.checked;
                updateCategoryGroupSelection(categoryIndex, groupIndex, checkbox.checked);
            }
        }

        function updateCategoryGroupSelection(categoryIndex, groupIndex, isSelected) {
            const groupItem = document.querySelector(`[data-category-group-index="${groupIndex}"]`);
            if (groupItem) {
                if (isSelected) {
                    groupItem.classList.add('selected');
                } else {
                    groupItem.classList.remove('selected');
                }
            }
        }

        function selectAllCategoryGroups(categoryIndex) {
            const groups = categoryGroupsData[categoryIndex] || [];
            groups.forEach((group, index) => {
                const checkbox = document.getElementById(`category-group-${categoryIndex}-${index}`);
                if (checkbox) {
                    checkbox.checked = true;
                    updateCategoryGroupSelection(categoryIndex, index, true);
                }
            });
        }

        function deselectAllCategoryGroups(categoryIndex) {
            const groups = categoryGroupsData[categoryIndex] || [];
            groups.forEach((group, index) => {
                const checkbox = document.getElementById(`category-group-${categoryIndex}-${index}`);
                if (checkbox) {
                    checkbox.checked = false;
                    updateCategoryGroupSelection(categoryIndex, index, false);
                }
            });
        }



        function addSelectedGroupsToCategory(categoryIndex) {
            const groups = categoryGroupsData[categoryIndex] || [];
            const selectedGroups = [];
            
            // Get selected groups
            groups.forEach((group, index) => {
                const checkbox = document.getElementById(`category-group-${categoryIndex}-${index}`);
                if (checkbox && checkbox.checked) {
                    selectedGroups.push({ group, index });
                }
            });
            
            if (selectedGroups.length === 0) {
                showFloatingNotification('Please select at least one group first', 'error');
                return;
            }

            // Add selected groups to the category
            selectedGroups.forEach(({ group }) => {
                categories[categoryIndex].groups.push({
                    name: group.name,
                    id: group.id,
                    member_count: group.member_count,
                    image_url: group.image_url
                });
            });

            // Save to MongoDB
            saveCompleteUserData().then(() => {
                // Reload categories display
                loadCategoriesFromMongoDB();
                
                // Clear the groups container for this category
                const groupsContainer = document.getElementById(`categoryGroupsContainer-${categoryIndex}`);
                if (groupsContainer) {
                    groupsContainer.classList.add('d-none');
                }
                
                // Clear the account selector
                const accountSelect = document.getElementById(`categoryAccountSelect-${categoryIndex}`);
                if (accountSelect) {
                    accountSelect.value = '';
                }
                
                // Clear stored groups data
                delete categoryGroupsData[categoryIndex];
                
                showFloatingNotification(`Added ${selectedGroups.length} group(s) to category successfully!`, 'success');
            });
        }



                function loadCategoriesFromMongoDB() {
            const container = document.getElementById('categoriesContainer');
            
            if (!container) {
                return;
            }
            
            if (categories.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No categories added yet. Click "Add New Category" to get started.
                    </div>
                `;
                return;
            }

            const htmlContent = categories.map((category, index) => `
                                <div class="group-category">
                    <div class="category-header" onclick="toggleGroupCategory(${index})">
                        <div class="category-info">
                            <i class="fas fa-folder me-2"></i>
                            <span class="category-name">${category.name}</span>
                            <span class="category-count">(${category.groups.length} groups)</span>
                        </div>
                        <div class="category-actions">
                            <button class="btn btn-outline-danger btn-sm" onclick="removeCategory(${index}); event.stopPropagation();">
                                <i class="fas fa-trash"></i>
                            </button>
                            <div class="category-arrow">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                    </div>
                    <div class="category-content">
                        <!-- Existing Groups -->
                    <div class="group-list">
                        ${category.groups.map((group, groupIndex) => `
                            <div class="group-tag">
                                    <img src="${group.image_url || 'https://via.placeholder.com/48x48/1877f2/ffffff?text=G'}" 
                                         alt="Group" class="group-avatar" 
                                         onerror="this.src='https://via.placeholder.com/48x48/1877f2/ffffff?text=G'">
                                    <div class="group-info">
                                        <span class="group-name">${group.name}</span>
                                    </div>
                                    <button class="remove-group" onclick="removeGroupFromCategory(${index}, ${groupIndex}); event.stopPropagation();">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `).join('')}
                        </div>
                        
                        <!-- Group Loader Section -->
                        <div class="group-loader-section" onclick="event.stopPropagation();">
                            <div class="group-loader-header">
                                <h6><i class="fas fa-download me-2"></i>Load Groups from Account</h6>
                            </div>
                            <div class="row">
                                <div class="col-md-8">
                                    <select class="form-select" id="categoryAccountSelect-${index}">
                                        <option value="">Select an account...</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-primary btn-sm w-100" onclick="loadGroupsForCategory(${index}); event.stopPropagation();">
                                        <i class="fas fa-download me-1"></i>Load
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Loading Status -->
                            <div id="categoryLoadingStatus-${index}" class="d-none">
                                <div class="text-center mt-2">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <span class="ms-2">Loading groups...</span>
                                </div>
                            </div>
                            
                            <!-- Available Groups for this Category -->
                            <div id="categoryGroupsContainer-${index}" class="d-none">
                                <div id="categoryGroupsList-${index}" class="category-groups-grid">
                                    <!-- Groups will be loaded here -->
                                </div>
                                <div class="text-center mt-3">
                                    <button type="button" class="btn btn-primary w-100" onclick="addSelectedGroupsToCategory(${index}); event.stopPropagation();">
                                        <i class="fas fa-plus me-2"></i>Add Selected Groups
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = htmlContent;
            updateCategoryDropdown();
            populateAllCategoryAccountSelectors();
        }

        function updateCategoryDropdown() {
            const dropdown = document.getElementById('newGroupCategory');
            if (!dropdown) {
                return;
            }
            
            dropdown.innerHTML = '<option value="">Select Category</option>';
            categories.forEach((category, index) => {
                dropdown.innerHTML += `<option value="${index}">${category.name}</option>`;
            });
        }



        function addCategory() {
            const categoryName = prompt('Enter category name:');
            if (categoryName && categoryName.trim()) {
                categories.push({
                    name: categoryName.trim(),
                    groups: []
                });
                saveCompleteUserData().then(() => {
                    loadCategoriesFromMongoDB();
                });
            }
        }

        function removeCategory(index) {
            if (confirm('Are you sure you want to remove this category?')) {
                categories.splice(index, 1);
                saveCompleteUserData().then(() => {
                    loadCategoriesFromMongoDB();
                });
            }
        }

        function removeGroupFromCategory(categoryIndex, groupIndex) {
            categories[categoryIndex].groups.splice(groupIndex, 1);
            saveCompleteUserData().then(() => {
                loadCategoriesFromMongoDB();
            });
        }





        function loadCategorySelector() {
            const container = document.getElementById('groupSelectorContent');
            if (categories.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        No categories available. Please add categories and groups in Group Management first.
                    </div>
                `;
                return;
            }

            container.innerHTML = categories.map((category, categoryIndex) => `
                <div class="category-selection-card" onclick="toggleCategorySelection(${categoryIndex})">
                    <div class="category-selection-header">
                        <div class="category-selection-checkbox">
                        <input class="form-check-input" type="checkbox" 
                               value="${categoryIndex}" 
                                   id="category-${categoryIndex}"
                                   onclick="event.stopPropagation()"
                                   onchange="updateSelectedGroupsDisplay()">
                            <label class="form-check-label" for="category-${categoryIndex}">
                                <i class="fas fa-folder me-2"></i>
                                <span class="category-title">${category.name}</span>
                                <span class="category-count">(${category.groups.length} groups)</span>
                        </label>
                    </div>
                        <div class="category-selection-arrow">
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                    <div class="category-selection-content">
                        <div class="group-list">
                            ${category.groups.map(group => `
                                <div class="group-tag">
                                    <img src="${group.image_url || 'https://via.placeholder.com/48x48/1877f2/ffffff?text=G'}" 
                                         alt="Group" class="group-avatar" 
                                         onerror="this.src='https://via.placeholder.com/48x48/1877f2/ffffff?text=G'">
                                    <div class="group-info">
                                        <span class="group-name">${group.name}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleCategorySelection(categoryIndex) {
            const card = document.querySelector(`#category-${categoryIndex}`).closest('.category-selection-card');
            const checkbox = document.querySelector(`#category-${categoryIndex}`);
            
            // Toggle the card selection
            card.classList.toggle('selected');
            
            // If card is selected, check the checkbox
            if (card.classList.contains('selected')) {
                checkbox.checked = true;
            } else {
                checkbox.checked = false;
            }
            
            // Update the selected groups display
            updateSelectedGroupsDisplay();
        }

        function toggleGroupCategory(categoryIndex) {
            const category = document.querySelector(`.group-category:nth-child(${categoryIndex + 1})`);
            category.classList.toggle('expanded');
        }

        function confirmCategorySelection() {
            selectedGroups = [];
            const checkboxes = document.querySelectorAll('#groupSelectorContent input[type="checkbox"]:checked');

            checkboxes.forEach(checkbox => {
                const categoryIndex = parseInt(checkbox.value);
                selectedGroups.push(...categories[categoryIndex].groups);
            });

            updateSelectedGroupsDisplay();
        }

        function updateSelectedGroupsDisplay() {
            // Get all checked category checkboxes
            const checkboxes = document.querySelectorAll('#groupSelectorContent input[type="checkbox"]:checked');
            selectedGroups = [];
            
            checkboxes.forEach(checkbox => {
                const categoryIndex = parseInt(checkbox.value);
                if (categories[categoryIndex] && categories[categoryIndex].groups) {
                    selectedGroups.push(...categories[categoryIndex].groups);
                }
            });
        }

        function fetchAndAddAccount() {
            const cookies = document.getElementById('newAccountCookies').value;

            if (!cookies) {
                alert('Please enter Facebook cookies');
                return;
            }

            // Show loading
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Fetching...';
            button.disabled = true;

            fetch('/fetch_account_info', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    cookies: cookies
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Save account to MongoDB
                        return saveAccountToMongoDB({
                            account_name: data.account_name,
                            user_id: data.user_id,
                            profile_pic_url: data.profile_pic_url,
                            cookies: data.cookies
                        });
                    } else {
                        throw new Error(data.error);
                    }
                })
                .then(saveResult => {
                    if (saveResult.success) {
                        // Reload data from MongoDB
                        loadUserDataFromMongoDB();

                        // Clear form
                        document.getElementById('newAccountCookies').value = '';

                        // Show success message
                        showFloatingNotification('Account added successfully!', 'success');
                        } else {
                        throw new Error(saveResult.error);
                    }
                })
                .catch(error => {
                    showFloatingNotification('Error: ' + error.message, 'error');
                })
                .finally(() => {
                    // Reset button
                    button.innerHTML = originalText;
                    button.disabled = false;
                });
        }

        function selectAccount(index) {
            // Select the clicked account
            selectedAccount = accounts[index];
            updateSelectedAccountDisplay();
        }

        function removeAccount(index) {
            if (confirm('Are you sure you want to remove this account?')) {
                accounts.splice(index, 1);
                // If we removed the selected account, clear selection
                if (selectedAccount && accounts.length === 0) {
                    selectedAccount = null;
                }
                saveCompleteUserData().then(() => {
                loadAccounts();
                updateSelectedAccountDisplay();
                });
            }
        }





        function loadAccountSelector() {
            const container = document.getElementById('accountSelectorContent');
            if (accounts.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        No accounts available. Please add accounts in Account Management first.
                    </div>
                `;
                return;
            }

            container.innerHTML = accounts.map((account, index) => `
                <div class="account-card mb-3 ${selectedAccount === account ? 'selected' : ''}" onclick="selectAccountFromModal(${index})">
                    <div class="account-header">
                        <img src="${account.profile_pic_url || 'https://via.placeholder.com/60x60/1877f2/ffffff?text=FB'}" 
                             alt="Profile" class="account-avatar" 
                             onerror="this.src='https://via.placeholder.com/60x60/1877f2/ffffff?text=FB'">
                        <div class="account-info">
                            <div class="account-name">${account.account_name}</div>
                            <div class="account-id">ID: ${account.user_id}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadPostSelectors() {
            loadAccountSelector();
            loadCategorySelector();
            loadPosterSelector();
        }

        function selectAccountFromModal(index) {
            // Select the clicked account
            selectedAccount = accounts[index];
            loadAccountSelector();
            updateSelectedAccountDisplay();
        }



        function updateSelectedAccountDisplay() {
            const container = document.getElementById('selectedAccountContainer');

            if (!selectedAccount) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No account selected. Please select an account above.
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>
                    Account selected: <strong>${selectedAccount.account_name}</strong>
                </div>
            `;
        }

        // Existing functions...
        function handleImageUpload() {
            // This function is no longer needed since we only use posters
            console.log('Manual image upload is disabled. Please use posters instead.');
        }

        // Drag and drop functionality for upload area
        function setupUploadAreaDragAndDrop() {
            const uploadArea = document.querySelector('.upload-area');
            if (!uploadArea) return;

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#42a5f5';
                uploadArea.style.background = 'linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%)';
            });

            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#1877f2';
                uploadArea.style.background = 'linear-gradient(135deg, #f0f2f5 0%, #e4e6eb 100%)';
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.style.borderColor = '#1877f2';
                uploadArea.style.background = 'linear-gradient(135deg, #f0f2f5 0%, #e4e6eb 100%)';

                const files = e.dataTransfer.files;
                const fileInput = document.getElementById('posterImages');
                
                // Create a DataTransfer object to set files
                const dataTransfer = new DataTransfer();
                for (let file of files) {
                    if (file.type.startsWith('image/')) {
                        dataTransfer.items.add(file);
                    }
                }
                
                fileInput.files = dataTransfer.files;
                handlePosterImageUpload();
            });
        }

        // Initialize upload area drag and drop
        setupUploadAreaDragAndDrop();

        // Add poster form submission handler
        document.getElementById('posterForm').addEventListener('submit', function(e) {
            e.preventDefault();
            savePoster();
        });

        // Add schedule button event handler
        document.getElementById('scheduleBtn').addEventListener('click', function(e) {
            e.preventDefault();
            schedulePost();
        });

        // Prevent form submission since we only use the schedule button
        document.getElementById('postForm').addEventListener('submit', function(e) {
            e.preventDefault();
        });



        // Add floating label functionality
        document.querySelectorAll('.floating-label input, .floating-label textarea').forEach(element => {
            element.addEventListener('focus', function () {
                this.parentElement.classList.add('focused');
            });

            element.addEventListener('blur', function () {
                if (!this.value) {
                    this.parentElement.classList.remove('focused');
                }
            });
        });

        // Floating notification function
        function showFloatingNotification(message, type = 'success', duration = 2000) {
            const notification = document.createElement('div');
            notification.className = `floating-notification alert alert-${type} alert-dismissible fade show`;
            notification.innerHTML = `
                <strong><i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-2"></i></strong>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after duration
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 500);
            }, duration);
        }

        // MongoDB Functions
        function loadUserDataFromMongoDB() {
            fetch('/get_user_data', {
                method: 'GET',
                credentials: 'same-origin',
                headers: {
                    'Cache-Control': 'no-cache',
                    'Pragma': 'no-cache'
                }
            })
                .then(response => {
                    if (!response.ok) {
                        if (response.status === 401 || response.status === 403) {
                            window.location.href = '/login';
                            return;
                        }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data) {
                        return;
                    }
                    
                    if (data.success) {
                        accounts = data.accounts || [];
                        categories = data.groups || [];
                        posters = data.posters || [];
                        
                        // No auto-creation of categories - users must create them manually
                        
                        // Check if containers exist before calling functions
                        const accountsContainer = document.getElementById('accountsContainer');
                        const categoriesContainer = document.getElementById('categoriesContainer');
                        const postersContainer = document.getElementById('postersContainer');
                        
                        if (accountsContainer) {
        loadAccounts();
                        }
                        
                        if (categoriesContainer) {
                            loadGroups();
                        }
                        
                        if (postersContainer) {
                            loadPosters();
                        }
                        
                        loadPostSelectors();
                    } else {
                        showFloatingNotification('Failed to load user data: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    showFloatingNotification('Error loading user data: ' + error.message, 'error');
                });
        }

        function saveAccountToMongoDB(accountData) {
            return fetch('/save_account', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(accountData)
            })
            .then(response => response.json());
        }

        function saveGroupToMongoDB(groupData) {
            return fetch('/save_group', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(groupData)
            })
            .then(response => response.json());
        }

        function saveCompleteUserData() {
            return fetch('/save_user_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    accounts: accounts,
                    groups: categories
                })
            })
            .then(response => response.json());
        }

        // Initialize
        showSection('welcome');
        
        // Set minimum date for datetime picker
        function setMinDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const minDateTime = `${year}-${month}-${day}T${hours}:${minutes}`;
            
            const dateTimeInput = document.getElementById('scheduledDateTime');
            if (dateTimeInput) {
                dateTimeInput.min = minDateTime;
            }
        }
        
        // Wait for DOM to be fully loaded before making the request
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                loadUserDataFromMongoDB();
                setMinDateTime();
            });
        } else {
            loadUserDataFromMongoDB();
            setMinDateTime();
        }
        
        // Also reload data when page becomes visible (handles refresh scenarios)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                loadUserDataFromMongoDB();
            }
        });

        function loadPosters() {
            const container = document.getElementById('postersContainer');
            
            if (!container) {
                return;
            }
            
            if (posters.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No posters created yet. Create your first poster below.
                    </div>
                `;
                return;
            }

            const htmlContent = posters.map((poster, index) => `
                <div class="poster-card">
                    <div class="poster-header">
                        <div class="poster-info">
                            <div class="poster-name">${poster.name}</div>
                            <div class="poster-caption">${poster.caption.substring(0, 100)}${poster.caption.length > 100 ? '...' : ''}</div>
                        </div>
                        <div class="poster-actions">
                            <button class="edit-poster-btn" onclick="loadPosterForEditing(${index})" title="Edit poster">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="remove-poster-btn" onclick="removePoster(${index})" title="Delete poster">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="poster-images">
                        ${poster.images.map((image, imgIndex) => `
                            <div class="poster-image-item">
                                <img src="${image.data}" alt="Poster Image" class="poster-thumbnail">
                                <div class="image-caption">${image.caption || 'No caption'}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = htmlContent;
        }

        // Global variable to store current images
        let currentImages = [];

        function handlePosterImageUpload() {
            const fileInput = document.getElementById('posterImages');
            const previewContainer = document.getElementById('posterImagePreviews');

            if (fileInput.files.length > 0) {
                // Convert new files to image objects
                const newImagePromises = [];
                for (let i = 0; i < fileInput.files.length; i++) {
                    const file = fileInput.files[i];
                    const promise = new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                            resolve({
                                id: Date.now() + Math.random(), // Unique ID for drag/drop
                                name: file.name,
                                caption: '',
                                data: e.target.result,
                                file: file // Keep reference to original file
                            });
                        };
                        reader.readAsDataURL(file);
                    });
                    newImagePromises.push(promise);
                }

                // Add new images to existing ones
                Promise.all(newImagePromises).then(newImages => {
                    currentImages = [...currentImages, ...newImages];
                    renderImagePreviews();
                });
            }

            // Clear the file input for next upload
            fileInput.value = '';
        }

        function renderImagePreviews() {
            const previewContainer = document.getElementById('posterImagePreviews');
            
            if (currentImages.length === 0) {
                previewContainer.innerHTML = `
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-images fa-3x mb-3"></i>
                        <p>No images uploaded yet. Upload images above to get started.</p>
                    </div>
                `;
                return;
            }

            const htmlContent = currentImages.map((image, index) => `
                <div class="image-preview-container fade-in-up" data-image-id="${image.id}" draggable="true">
                            <div class="row align-items-center">
                        <div class="col-md-2 text-center">
                            <div class="image-preview-wrapper">
                                <img src="${image.data}" class="image-preview" alt="Preview">
                                <div class="image-actions">
                                    <button type="button" class="btn btn-sm btn-danger remove-image-btn" onclick="removeImage(${index})" title="Remove image">
                                        <i class="fas fa-times"></i>
                                    </button>
                                    <div class="drag-handle" title="Drag to reorder">
                                        <i class="fas fa-grip-vertical"></i>
                                </div>
                                </div>
                                <div class="image-order-badge">${index + 1}</div>
                            </div>
                        </div>
                        <div class="col-md-10">
                            <label class="form-label">Caption for ${image.name} (Optional)</label>
                            <input type="text" class="form-control poster-image-caption" 
                                   placeholder="Enter a caption for this image..."
                                   value="${image.caption || ''}"
                                   onchange="updateImageCaption(${index}, this.value)">
                                    <div class="help-text mt-2">
                                        <i class="fas fa-info-circle"></i>
                                        Add a specific caption for this image
                                    </div>
                                </div>
                            </div>
                </div>
            `).join('');

            previewContainer.innerHTML = htmlContent;
            
            // Add drag and drop functionality for reordering
            setupImageDragAndDrop();
        }

        function setupImageDragAndDrop() {
            const containers = document.querySelectorAll('.image-preview-container');
            
            containers.forEach(container => {
                container.addEventListener('dragstart', handleDragStart);
                container.addEventListener('dragover', handleDragOver);
                container.addEventListener('drop', handleDrop);
                container.addEventListener('dragenter', handleDragEnter);
                container.addEventListener('dragleave', handleDragLeave);
            });
        }

        function handleDragStart(e) {
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
            e.target.classList.add('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            e.preventDefault();
            e.target.closest('.image-preview-container')?.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.target.closest('.image-preview-container')?.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            const draggingElement = document.querySelector('.dragging');
            const dropTarget = e.target.closest('.image-preview-container');
            
            if (draggingElement && dropTarget && draggingElement !== dropTarget) {
                const draggingId = draggingElement.dataset.imageId;
                const dropId = dropTarget.dataset.imageId;
                
                // Find indices
                const draggingIndex = currentImages.findIndex(img => img.id == draggingId);
                const dropIndex = currentImages.findIndex(img => img.id == dropId);
                
                if (draggingIndex !== -1 && dropIndex !== -1) {
                    // Reorder array
                    const [movedImage] = currentImages.splice(draggingIndex, 1);
                    currentImages.splice(dropIndex, 0, movedImage);
                    
                    // Re-render to update order
                    renderImagePreviews();
                }
            }
            
            // Clean up
            document.querySelectorAll('.image-preview-container').forEach(container => {
                container.classList.remove('dragging', 'drag-over');
            });
        }

        function removeImage(index) {
            currentImages.splice(index, 1);
            renderImagePreviews();
        }

        function updateImageCaption(index, caption) {
            if (currentImages[index]) {
                currentImages[index].caption = caption;
            }
        }



        function savePoster() {
            const saveBtn = document.getElementById('savePosterBtn');
            if (!saveBtn) return;

            // Show loading state
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';

            const name = document.getElementById('posterName').value.trim();
            const caption = document.getElementById('posterCaption').value.trim();

            if (!name || !caption || currentImages.length === 0) {
                showFloatingNotification('Please fill in all required fields and upload at least one image.', 'error');
                // Reset button state
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save me-2"></i>Save Poster';
                return;
            }

            // Prepare images data (remove file reference, keep only necessary data)
            const imagesData = currentImages.map(image => ({
                name: image.name,
                caption: image.caption || '',
                data: image.data
            }));

            // Save poster to MongoDB
            const posterData = {
                name: name,
                caption: caption,
                images: imagesData
            };

            savePosterToMongoDB(posterData)
                .then(result => {
                    if (result.success) {
                        // Reload data from MongoDB
                        loadUserDataFromMongoDB();
                        
                        // Clear form
                        document.getElementById('posterForm').reset();
                        currentImages = [];
                        renderImagePreviews();

                        showFloatingNotification('Poster saved successfully!', 'success');
                    } else {
                        showFloatingNotification('Error: ' + result.error, 'error');
                    }
                })
                .catch(error => {
                    showFloatingNotification('Error saving poster: ' + error.message, 'error');
                })
                .finally(() => {
                    // Reset button state
                    saveBtn.disabled = false;
                    saveBtn.innerHTML = '<i class="fas fa-save me-2"></i>Save Poster';
                });
        }

        function removePoster(index) {
            if (confirm('Are you sure you want to remove this poster?')) {
                // Check if we're removing the currently selected poster
                const posterToRemove = posters[index];
                if (selectedPoster === posterToRemove) {
                    selectedPoster = null;
                }
                
                posters.splice(index, 1);
                
                // Save updated posters to MongoDB
                const userData = {
                    accounts: accounts,
                    groups: categories,
                    posters: posters
                };
                
                fetch('/save_user_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        loadPosters();
                        updateSelectedPosterDisplay();
                        showFloatingNotification('Poster removed successfully!', 'success');
                    } else {
                        showFloatingNotification('Error removing poster: ' + result.error, 'error');
                    }
                })
                .catch(error => {
                    showFloatingNotification('Error removing poster: ' + error.message, 'error');
                });
            }
        }

        function selectPosterFromModal(index) {
            selectedPoster = posters[index];
            loadPosterSelector();
            updateSelectedPosterDisplay();
        }

        function loadPosterForEditing(index) {
            const poster = posters[index];
            if (!poster) return;

            // Populate form fields
            document.getElementById('posterName').value = poster.name;
            document.getElementById('posterCaption').value = poster.caption;
            
            // Convert poster images to currentImages format
            currentImages = poster.images.map((image, imgIndex) => ({
                id: Date.now() + imgIndex + Math.random(), // Generate unique ID
                name: image.name,
                caption: image.caption || '',
                data: image.data
            }));
            
            // Render the images
            renderImagePreviews();
        }

        function updateSelectedPosterDisplay() {
            const container = document.getElementById('selectedPosterContainer');

            if (!selectedPoster) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Please select a poster to create your post. You can create posters in Poster Management.
                    </div>
                `;
                return;
            }

            // Populate form with poster data
            document.getElementById('main_caption').value = selectedPoster.caption;
            
            // Create image previews from poster data
            const imagePreviewsContainer = document.getElementById('imagePreviews');
            imagePreviewsContainer.innerHTML = '';
            
            selectedPoster.images.forEach((image, index) => {
                const previewDiv = document.createElement('div');
                previewDiv.className = 'image-preview-container fade-in-up';
                previewDiv.innerHTML = `
                    <div class="row align-items-center">
                        <div class="col-md-3 text-center">
                            <img src="${image.data}" class="image-preview" alt="Preview">
                        </div>
                        <div class="col-md-9">
                            <label class="form-label">Caption for ${image.name}</label>
                            <input type="text" class="form-control" name="image_captions" 
                                   value="${image.caption || ''}" readonly>
                            <div class="help-text mt-2">
                                <i class="fas fa-info-circle"></i>
                                Caption from selected poster
                            </div>
                        </div>
                    </div>
                `;
                imagePreviewsContainer.appendChild(previewDiv);
            });
        }



        function loadPosterSelector() {
            const container = document.getElementById('posterSelectorContent');
            if (posters.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        No posters available. Please create posters in Poster Management first.
                    </div>
                `;
                return;
            }

            container.innerHTML = posters.map((poster, index) => `
                <div class="poster-card mb-3 ${selectedPoster === poster ? 'selected' : ''}" onclick="selectPosterFromModal(${index})">
                    <div class="poster-header">
                        <div class="poster-info">
                            <div class="poster-name">${poster.name}</div>
                            <div class="poster-caption">${poster.caption.substring(0, 100)}${poster.caption.length > 100 ? '...' : ''}</div>
                        </div>
                    </div>
                    <div class="poster-images">
                        ${poster.images.map(image => `
                            <div class="poster-image-item">
                                <img src="${image.data}" alt="Poster Image" class="poster-thumbnail">
                                <div class="image-caption">${image.caption || 'No caption'}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function savePosterToMongoDB(posterData) {
            return fetch('/save_poster', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(posterData)
            })
            .then(response => response.json());
        }

        function schedulePost() {
            if (!selectedAccount) {
                showFloatingNotification('Please select an account before scheduling.', 'error');
                return;
            }

            // Update selected groups from checkboxes before validation
            updateSelectedGroupsDisplay();

            if (selectedGroups.length === 0) {
                showFloatingNotification('Please select at least one group before scheduling.', 'error');
                return;
            }

            if (!selectedPoster) {
                showFloatingNotification('Please select a poster before scheduling.', 'error');
                return;
            }

            const scheduledDateTime = document.getElementById('scheduledDateTime').value;
            if (!scheduledDateTime) {
                showFloatingNotification('Please select a date and time for scheduling.', 'error');
                return;
            }

            const scheduledTime = new Date(scheduledDateTime);
            if (scheduledTime <= new Date()) {
                showFloatingNotification('Scheduled time must be in the future.', 'error');
                return;
            }

            const scheduleBtn = document.getElementById('scheduleBtn');
            const loading = document.getElementById('loading');

            // Show loading
            scheduleBtn.style.display = 'none';
            loading.style.display = 'block';

            // Convert base64 images to blobs first
            const imagePromises = selectedPoster.images.map(image => {
                return fetch(image.data)
                    .then(res => res.blob())
                    .then(blob => ({
                        blob: blob,
                        name: image.name,
                        caption: image.caption || ''
                    }));
            });

            // Wait for all images to be converted
            Promise.all(imagePromises)
                .then(imageBlobs => {
                    // Get user's timezone offset
                    const timezoneOffset = new Date().getTimezoneOffset() / -60; // Convert to hours
                    
                    // Prepare scheduled post data
                    const scheduledPostData = {
                        group_ids: selectedGroups.map(group => group.id),
                        main_caption: selectedPoster.caption,
                        cookies: selectedAccount.cookies,
                        scheduled_time: scheduledDateTime, // Send local time, backend will convert to UTC
                        timezone_offset: timezoneOffset, // Send user's timezone offset
                        poster_name: selectedPoster.name,
                        account_name: selectedAccount.account_name,
                        groups: selectedGroups.map(group => group.name),
                        images: selectedPoster.images // Use the original base64 data
                    };

                    // Submit the scheduled post
                    return fetch('/schedule_post', {
                method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(scheduledPostData)
                    });
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showFloatingNotification(data.message, 'success');

                        // Reset form
                        document.getElementById('scheduledDateTime').value = '';
                        selectedGroups = [];
                        selectedPoster = null;
                        updateSelectedGroupsDisplay();
                        updateSelectedPosterDisplay();
                    } else {
                        showFloatingNotification(data.error, 'error');
                    }
                })
                .catch(error => {
                    showFloatingNotification(`An unexpected error occurred: ${error.message}`, 'error');
                })
                .finally(() => {
                    // Hide loading
                    scheduleBtn.style.display = 'block';
                    loading.style.display = 'none';
                });
        }

        // Scheduled Posts Functions
        function loadScheduledPosts() {
            fetch('/get_scheduled_posts', {
                method: 'GET',
                credentials: 'same-origin',
                headers: {
                    'Cache-Control': 'no-cache',
                    'Pragma': 'no-cache'
                }
            })
                .then(response => {
                    if (!response.ok) {
                        if (response.status === 401 || response.status === 403) {
                            window.location.href = '/login';
                            return;
                        }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data) {
                        return;
                    }
                    
                    if (data.success) {
                        displayScheduledPosts(data.posts || []);
                    } else {
                        showFloatingNotification('Failed to load scheduled posts: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    showFloatingNotification('Error loading scheduled posts: ' + error.message, 'error');
                });
        }

        // Debug function to show time conversion details
        function debugTimeConversion(utcTimeString, localTime) {
            console.log('🔍 Time Debug:');
            console.log('  UTC string from backend:', utcTimeString);
            console.log('  Parsed as UTC:', new Date(utcTimeString + 'Z'));
            console.log('  Displayed as local:', localTime);
            console.log('  Local timezone offset:', new Date().getTimezoneOffset(), 'minutes');
        }

        function displayScheduledPosts(posts) {
            const container = document.getElementById('scheduledPostsContainer');
            
            if (!container) {
                return;
            }
            
            if (posts.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clock"></i>
                        <h4>No Posts Yet</h4>
                        <p>You haven't scheduled or published any posts yet. Create your first post in the Create Post section.</p>
                    </div>
                `;
                return;
            }

            const htmlContent = posts.map((post, index) => {
                // Parse UTC times and convert to local time for display
                const scheduledTime = new Date(post.scheduled_time + 'Z');
                const createdTime = new Date(post.created_at + 'Z');
                const publishedTime = post.published_at ? new Date(post.published_at + 'Z') : null;
                
                // Debug time conversion for the first post
                if (index === 0) {
                    debugTimeConversion(post.scheduled_time, scheduledTime);
                }
                
                const status = post.status;
                
                let statusBadge = '';
                let statusClass = '';
                let statusIcon = '';
                
                switch (status) {
                    case 'scheduled':
                        statusBadge = '<span class="status-badge scheduled"><i class="fas fa-clock"></i>Scheduled</span>';
                        statusClass = 'scheduled';
                        statusIcon = 'fas fa-clock';
                        break;
                    case 'published':
                        statusBadge = '<span class="status-badge published"><i class="fas fa-check-circle"></i>Published</span>';
                        statusClass = 'published';
                        statusIcon = 'fas fa-check-circle';
                        break;
                    case 'partial':
                        statusBadge = '<span class="status-badge partial"><i class="fas fa-exclamation-triangle"></i>Partial</span>';
                        statusClass = 'partial';
                        statusIcon = 'fas fa-exclamation-triangle';
                        break;
                    case 'failed':
                        statusBadge = '<span class="status-badge failed"><i class="fas fa-times-circle"></i>Failed</span>';
                        statusClass = 'failed';
                        statusIcon = 'fas fa-times-circle';
                        break;
                    default:
                        statusBadge = '<span class="status-badge unknown"><i class="fas fa-question-circle"></i>Unknown</span>';
                        statusClass = 'unknown';
                        statusIcon = 'fas fa-question-circle';
                }
                
                let resultInfo = '';
                let resultClass = '';
                
                if (post.result) {
                    if (post.result.successful_posts !== undefined) {
                        const successRate = post.result.successful_posts / post.result.total_groups;
                        if (successRate === 1) {
                            resultClass = 'success';
                            resultInfo = `
                                <div class="result-info ${resultClass}">
                                    <div class="d-flex align-items-center gap-2">
                                        <i class="fas fa-check-circle text-success"></i>
                                        <strong>Success!</strong> Published to all ${post.result.total_groups} groups
                                    </div>
                                </div>
                            `;
                        } else if (successRate > 0) {
                            resultClass = 'warning';
                            resultInfo = `
                                <div class="result-info ${resultClass}">
                                    <div class="d-flex align-items-center gap-2">
                                        <i class="fas fa-exclamation-triangle text-warning"></i>
                                        <strong>Partial Success:</strong> ${post.result.successful_posts} of ${post.result.total_groups} groups
                                    </div>
                                </div>
                            `;
                        } else {
                            resultClass = 'error';
                            resultInfo = `
                                <div class="result-info ${resultClass}">
                                    <div class="d-flex align-items-center gap-2">
                                        <i class="fas fa-times-circle text-danger"></i>
                                        <strong>Failed:</strong> 0 of ${post.result.total_groups} groups
                                    </div>
                                </div>
                            `;
                        }
                    } else if (post.result.error) {
                        resultClass = 'error';
                        resultInfo = `
                            <div class="result-info ${resultClass}">
                                <div class="d-flex align-items-center gap-2">
                                    <i class="fas fa-exclamation-triangle text-danger"></i>
                                    <strong>Error:</strong> ${post.result.error}
                                </div>
                            </div>
                        `;
                    }
                }
                
                let deleteButton = '';
                if (status === 'scheduled') {
                    deleteButton = `
                        <button class="action-btn cancel" onclick="deleteScheduledPost('${post._id}')">
                            <i class="fas fa-trash"></i>
                            Cancel Post
                        </button>
                    `;
                }
                
                return `
                    <div class="post-card ${statusClass}">
                        <div class="post-header">
                            <div class="post-info">
                                <div class="post-title">
                                    <i class="${statusIcon}"></i>
                                    ${post.poster_name}
                                </div>
                                <div class="post-meta">
                                    <div class="meta-item">
                                        <i class="fas fa-user"></i>
                                        ${post.account_name}
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-users"></i>
                                        ${post.groups ? post.groups.length : 0} groups
                                    </div>
                                </div>
                            </div>
                            <div class="post-status">
                                ${statusBadge}
                            </div>
                        </div>
                        
                        <div class="post-body">
                            <div class="post-details">
                                <div class="detail-item">
                                    <div class="detail-label">Scheduled For</div>
                                    <div class="detail-value">
                                        <i class="fas fa-calendar-alt me-1"></i>
                                        ${scheduledTime.toLocaleDateString('en-US', { 
                                            weekday: 'long', 
                                            year: 'numeric', 
                                            month: 'long', 
                                            day: 'numeric' 
                                        })}
                                    </div>
                                    <div class="detail-value">
                                        <i class="fas fa-clock me-1"></i>
                                        ${scheduledTime.toLocaleTimeString('en-US', { 
                                            hour: '2-digit', 
                                            minute: '2-digit',
                                            timeZoneName: 'short'
                                        })}
                                    </div>
                                </div>
                                
                                <div class="detail-item">
                                    <div class="detail-label">Created</div>
                                    <div class="detail-value">
                                        <i class="fas fa-calendar-plus me-1"></i>
                                        ${createdTime.toLocaleDateString('en-US', { 
                                            month: 'short', 
                                            day: 'numeric', 
                                            year: 'numeric' 
                                        })}
                                    </div>
                                    <div class="detail-value">
                                        <i class="fas fa-clock me-1"></i>
                                        ${createdTime.toLocaleTimeString('en-US', { 
                                            hour: '2-digit', 
                                            minute: '2-digit' 
                                        })}
                                    </div>
                                </div>
                                
                                ${publishedTime ? `
                                <div class="detail-item">
                                    <div class="detail-label">Published</div>
                                    <div class="detail-value">
                                        <i class="fas fa-calendar-check me-1"></i>
                                        ${publishedTime.toLocaleDateString('en-US', { 
                                            month: 'short', 
                                            day: 'numeric', 
                                            year: 'numeric' 
                                        })}
                                    </div>
                                    <div class="detail-value">
                                        <i class="fas fa-clock me-1"></i>
                                        ${publishedTime.toLocaleTimeString('en-US', { 
                                            hour: '2-digit', 
                                            minute: '2-digit' 
                                        })}
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                            
                            ${deleteButton ? `
                            <div class="post-actions">
                                ${deleteButton}
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = htmlContent;
        }

        function deleteScheduledPost(postId) {
            if (!confirm('Are you sure you want to cancel this scheduled post?')) {
                return;
            }
            
            fetch('/delete_scheduled_post', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    post_id: postId
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showFloatingNotification('Scheduled post cancelled successfully!', 'success');
                        loadScheduledPosts(); // Reload the list
                    } else {
                        showFloatingNotification('Error: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    showFloatingNotification('Error cancelling post: ' + error.message, 'error');
                });
        }

        function clearAllHistory() {
            if (!confirm('Are you sure you want to clear all scheduled and published posts? This cannot be undone.')) {
                return;
            }
            fetch('/clear_scheduled_history', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showFloatingNotification('All scheduled and published posts have been deleted.', 'success');
                    loadScheduledPosts();
                } else {
                    showFloatingNotification('Error: ' + data.error, 'error');
                }
            })
            .catch(error => {
                showFloatingNotification('Error clearing history: ' + error.message, 'error');
            });
        }
    </script>
</body>
</html>
