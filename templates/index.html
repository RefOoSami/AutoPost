<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Auto Post Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #1c1e21;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(108, 117, 125, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(173, 181, 189, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(206, 212, 218, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* Animated Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            background: rgba(108, 117, 125, 0.15);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        .particle:nth-child(1) {
            width: 4px;
            height: 4px;
            left: 10%;
            animation-delay: 0s;
            animation-duration: 8s;
        }

        .particle:nth-child(2) {
            width: 6px;
            height: 6px;
            left: 20%;
            animation-delay: 1s;
            animation-duration: 10s;
        }

        .particle:nth-child(3) {
            width: 3px;
            height: 3px;
            left: 30%;
            animation-delay: 2s;
            animation-duration: 7s;
        }

        .particle:nth-child(4) {
            width: 5px;
            height: 5px;
            left: 40%;
            animation-delay: 3s;
            animation-duration: 9s;
        }

        .particle:nth-child(5) {
            width: 4px;
            height: 4px;
            left: 50%;
            animation-delay: 4s;
            animation-duration: 6s;
        }

        .particle:nth-child(6) {
            width: 6px;
            height: 6px;
            left: 60%;
            animation-delay: 5s;
            animation-duration: 11s;
        }

        .particle:nth-child(7) {
            width: 3px;
            height: 3px;
            left: 70%;
            animation-delay: 6s;
            animation-duration: 8s;
        }

        .particle:nth-child(8) {
            width: 5px;
            height: 5px;
            left: 80%;
            animation-delay: 7s;
            animation-duration: 10s;
        }

        .particle:nth-child(9) {
            width: 4px;
            height: 4px;
            left: 90%;
            animation-delay: 8s;
            animation-duration: 7s;
        }

        .particle:nth-child(10) {
            width: 6px;
            height: 6px;
            left: 95%;
            animation-delay: 9s;
            animation-duration: 9s;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Floating Notification Styles */
        .floating-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 400px;
            animation: slideInRight 0.3s ease-out;
        }

        .floating-notification.fade-out {
            animation: fadeOut 0.5s ease-out forwards;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 80px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: all 0.3s ease;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 1.5rem 0.5rem;
            background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%);
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .sidebar-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }

        .sidebar-header h3 {
            margin: 0;
            font-weight: 700;
            font-size: 1.2rem;
            position: relative;
            z-index: 1;
        }

        .user-info {
            margin-top: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .user-name {
            font-size: 0.7rem;
            color: white;
            text-align: center;
            font-weight: 500;
            line-height: 1.2;
            max-width: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .sidebar-nav {
            padding: 1rem 0;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 120px);
        }

        .nav-item.mt-auto {
            margin-top: auto;
        }

        .nav-item {
            margin: 0.5rem 0.75rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            color: #1c1e21;
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
            width: 48px;
            height: 48px;
            margin: 0 auto;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .nav-link:hover::before {
            left: 100%;
        }

        .nav-link:hover {
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
            color: #1877f2;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.15);
        }

        .nav-link.active {
            background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%);
            color: white;
            box-shadow: 0 4px 16px rgba(24, 119, 242, 0.3);
        }

        .nav-link.active::before {
            display: none;
        }

        .nav-link i {
            font-size: 1.4rem;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            margin-left: 80px;
            min-height: 100vh;
            padding: 2rem;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Group Management Styles */
        .group-category {
            background: #fff;
            border: 2px solid #e4e6eb;
            border-radius: 16px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .group-category:hover {
            border-color: #1877f2;
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.1);
            transform: translateY(-2px);
        }

        .group-category.expanded {
            border-color: #1877f2;
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        }

        .category-info {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #1c1e21;
        }

        .category-name {
            font-size: 1.1rem;
            margin-right: 0.5rem;
        }

        .category-count {
            color: #65676b;
            font-weight: 400;
            font-size: 0.9rem;
        }

        .category-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .category-arrow {
            color: #65676b;
            transition: transform 0.3s ease;
        }

        .group-category.expanded .category-arrow {
            transform: rotate(180deg);
            color: #1877f2;
        }

        .category-content {
            padding: 0 1.5rem 1.5rem;
            display: none;
        }

        .group-category.expanded .category-content {
            display: block;
        }

        .add-group-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e4e6eb;
        }

        .add-group-section .floating-label {
            margin-bottom: 0;
        }

        .add-group-section .form-control {
            border-radius: 8px;
            border: 2px solid #e4e6eb;
            transition: all 0.3s ease;
        }

        .add-group-section .form-control:focus {
            border-color: #1877f2;
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
        }

        .add-group-section .btn {
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .add-group-section .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.2);
        }

        .group-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .group-tag {
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
            border: 1px solid #1877f2;
            color: #1877f2;
            padding: 1rem;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            height: 80px;
            transition: all 0.3s ease;
        }

        .group-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.2);
        }

        .group-tag .remove-group {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .group-tag .remove-group:hover {
            background: #dc3545;
            color: white;
            transform: scale(1.1);
        }

        .add-category-btn {
            background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%);
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            font-weight: 600;
            font-size: 1.1rem;
            color: white;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .add-category-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(24, 119, 242, 0.3);
        }

        .add-category-btn:active {
            transform: translateY(0);
        }

        /* Category Selection Styles */
        .category-selection-card {
            background: #fff;
            border: 2px solid #e4e6eb;
            border-radius: 16px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .category-selection-card:hover {
            border-color: #1877f2;
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.1);
            transform: translateY(-2px);
        }

        .category-selection-card.selected {
            border-color: #1877f2;
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
        }

        .category-selection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        }

        .category-selection-checkbox {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .category-selection-checkbox .form-check-input {
            width: 20px;
            height: 20px;
            border: 2px solid #1877f2;
            border-radius: 4px;
            cursor: pointer;
        }

        .category-selection-checkbox .form-check-input:checked {
            background-color: #1877f2;
            border-color: #1877f2;
        }

        .category-selection-checkbox .form-check-label {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #1c1e21;
            cursor: pointer;
        }

        .category-title {
            font-size: 1.1rem;
            margin-right: 0.5rem;
        }

        .category-count {
            color: #65676b;
            font-weight: 400;
            font-size: 0.9rem;
        }

        .category-selection-arrow {
            color: #65676b;
            transition: transform 0.3s ease;
        }

        .category-selection-card.selected .category-selection-arrow {
            transform: rotate(180deg);
            color: #1877f2;
        }

        .category-selection-content {
            padding: 0 1.5rem 1.5rem;
            display: none;
        }

        .category-selection-card.selected .category-selection-content {
            display: block;
        }

        /* Form improvements */
        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #fff;
            border-radius: 16px;
            border: 1px solid #e4e6eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .floating-label select {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e4e6eb;
            border-radius: 12px;
            font-size: 1rem;
            background: #fff;
            transition: all 0.3s ease;
        }

        .floating-label select:focus {
            border-color: #1877f2;
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
            outline: none;
        }

        .group-tag {
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
            border: 1px solid #1877f2;
            color: #1877f2;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.25rem;
        }

        .group-tag .member-count {
            font-size: 0.8rem;
            color: #65676b;
            font-weight: 400;
        }

        .group-tag .group-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #1877f2;
        }

        .group-tag .group-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            flex: 1;
        }

        .group-tag .group-name {
            font-weight: 600;
            color: #1877f2;
            font-size: 0.95rem;
        }

        /* Account Management Styles */
        .account-card {
            background: #fff;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e4e6eb;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .account-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .account-card.selected {
            border-color: #1877f2;
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
            box-shadow: 0 8px 24px rgba(24, 119, 242, 0.2);
        }

        .account-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .account-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #1877f2;
        }

        .account-info {
            flex: 1;
        }

        .account-name {
            font-weight: 600;
            color: #1c1e21;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .account-id {
            font-size: 0.9rem;
            color: #65676b;
        }

        .account-actions {
            display: flex;
            gap: 0.5rem;
        }



        .remove-account-btn {
            background: none;
            border: 1px solid #dc3545;
            color: #dc3545;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .remove-account-btn:hover {
            background: #dc3545;
            color: white;
        }

        /* Mobile Responsive */
        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%);
            border: none;
            color: white;
            padding: 1rem;
            border-radius: 12px;
            font-size: 1.2rem;
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.3);
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(24, 119, 242, 0.4);
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 80px;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .sidebar-toggle {
                display: block;
            }
        }

        /* Existing styles... */
        .main-container {
            min-height: 100vh;
            padding: 2rem 0;
        }

        .card {
            border: none;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(15px);
            background: rgba(255, 255, 255, 0.95);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card-header {
            background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%);
            border: none;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .card-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }

        .card-header h3 {
            position: relative;
            z-index: 1;
            font-weight: 700;
            font-size: 2rem;
            margin: 0;
        }

        .card-body {
            padding: 3rem;
        }

        .form-label {
            font-weight: 600;
            color: #1c1e21;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .form-control,
        .form-select {
            border: 2px solid #e4e6eb;
            border-radius: 12px;
            padding: 1rem 1.25rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: #1877f2;
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
            background: #fff;
        }

        .form-control::placeholder {
            color: #65676b;
        }

        .upload-area {
            border: 3px dashed #1877f2;
            border-radius: 16px;
            padding: 3rem 2rem;
            text-align: center;
            background: linear-gradient(135deg, #f0f2f5 0%, #e4e6eb 100%);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover {
            border-color: #42a5f5;
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
            transform: translateY(-2px);
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .upload-area:hover::before {
            left: 100%;
        }

        .upload-icon {
            font-size: 3rem;
            color: #1877f2;
            margin-bottom: 1rem;
        }

        .image-preview-container {
            background: #fff;
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e4e6eb;
            transition: all 0.3s ease;
        }

        .image-preview-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .image-preview {
            width: 100%;
            max-width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #1877f2 0%, #42a5f5 100%);
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(24, 119, 242, 0.3);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .loading {
            display: none;
            padding: 2rem;
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
        }

        .alert {
            border: none;
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            margin-top: 1.5rem;
            font-weight: 500;
        }

        .alert-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
        }

        .alert-danger {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1c1e21;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-title i {
            color: #1877f2;
            font-size: 1.5rem;
        }

        .progress-bar {
            height: 4px;
            background: #e4e6eb;
            border-radius: 2px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #1877f2, #42a5f5);
            width: 0%;
            transition: width 0.3s ease;
        }

        .floating-label {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .floating-label input,
        .floating-label textarea {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e4e6eb;
            border-radius: 12px;
            font-size: 1rem;
            background: #fff;
            transition: all 0.3s ease;
        }

        .floating-label input:focus,
        .floating-label textarea:focus {
            border-color: #1877f2;
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
            outline: none;
        }

        .floating-label label {
            position: absolute;
            left: 1.25rem;
            top: 1rem;
            color: #65676b;
            transition: all 0.3s ease;
            pointer-events: none;
            font-size: 1rem;
        }

        .floating-label input:focus+label,
        .floating-label textarea:focus+label,
        .floating-label input:not(:placeholder-shown)+label,
        .floating-label textarea:not(:placeholder-shown)+label {
            top: 0.5rem;
            font-size: 0.8rem;
            color: #1877f2;
            font-weight: 600;
        }

        .help-text {
            font-size: 0.875rem;
            color: #65676b;
            margin-top: 0.5rem;
            line-height: 1.4;
        }

        .cookie-instructions {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 1px solid #ffeaa7;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .cookie-instructions ol {
            margin: 0;
            padding-left: 1.5rem;
        }

        .cookie-instructions li {
            margin-bottom: 0.5rem;
            color: #856404;
        }

        .group-input-container {
            position: relative;
            transition: all 0.3s ease;
        }

        .group-input-container:hover {
            transform: translateY(-1px);
        }

        .btn-outline-primary {
            border-color: #1877f2;
            color: #1877f2;
            transition: all 0.3s ease;
        }

        .btn-outline-primary:hover {
            background-color: #1877f2;
            border-color: #1877f2;
            color: white;
            transform: translateY(-1px);
        }

        .btn-outline-danger {
            border-color: #dc3545;
            color: #dc3545;
            transition: all 0.3s ease;
        }

        .btn-outline-danger:hover {
            background-color: #dc3545;
            border-color: #dc3545;
            color: white;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @media (max-width: 768px) {
            .card-body {
                padding: 2rem 1.5rem;
            }

            .form-section {
                padding: 1.5rem;
            }

            .card-header {
                padding: 1.5rem;
            }

            .card-header h3 {
                font-size: 1.5rem;
            }
        }

        /* Poster Management Styles */
        .poster-card {
            background: #fff;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e4e6eb;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .poster-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .poster-card.selected {
            border-color: #1877f2;
            background: linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%);
            box-shadow: 0 8px 24px rgba(24, 119, 242, 0.2);
        }

        .poster-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .poster-info {
            flex: 1;
        }

        .poster-name {
            font-weight: 600;
            color: #1c1e21;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .poster-caption {
            color: #65676b;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .poster-actions {
            display: flex;
            gap: 0.5rem;
        }

        .remove-poster-btn {
            background: none;
            border: 1px solid #dc3545;
            color: #dc3545;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .remove-poster-btn:hover {
            background: #dc3545;
            color: white;
        }

        .poster-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
        }

        .poster-image-item {
            text-align: center;
        }

        .poster-thumbnail {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #e4e6eb;
            margin-bottom: 0.5rem;
        }

        .image-caption {
            font-size: 0.8rem;
            color: #65676b;
            line-height: 1.2;
            word-break: break-word;
        }

        /* Scheduled Posts Styles */
        .scheduled-post {
            border-left: 4px solid #ffc107;
        }

        .published-post {
            border-left: 4px solid #28a745;
        }

        .partial-post {
            border-left: 4px solid #fd7e14;
        }

        .failed-post {
            border-left: 4px solid #dc3545;
        }

        .unknown-post {
            border-left: 4px solid #6c757d;
        }

        .badge {
            font-size: 0.75rem;
            padding: 0.375rem 0.75rem;
            border-radius: 0.375rem;
        }

        .bg-warning {
            background-color: #ffc107 !important;
            color: #000 !important;
        }

        .bg-success {
            background-color: #28a745 !important;
            color: #fff !important;
        }

        .bg-danger {
            background-color: #dc3545 !important;
            color: #fff !important;
        }

        .bg-secondary {
            background-color: #6c757d !important;
            color: #fff !important;
        }

        /* Existing styles... */
    </style>
</head>

<body>
    <!-- Animated Particles -->
    <div class="particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <!-- Sidebar Toggle for Mobile -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            {% if user %}
            <div class="user-info">
                <img src="{{ user.user_picture }}" alt="Profile" class="user-avatar" onerror="this.src='https://via.placeholder.com/32x32/1877f2/ffffff?text=U'">
                <span class="user-name">{{ user.user_name }}</span>
            </div>
            {% endif %}
        </div>
        <nav class="sidebar-nav">
            <div class="nav-item">
                <a href="#" class="nav-link active" onclick="showSection('accounts', event)" title="Account Management">
                    <i class="fas fa-user-circle"></i>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('groups', event)" title="Group Management">
                    <i class="fas fa-users"></i>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('posters', event)" title="Poster Management">
                    <i class="fas fa-image"></i>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('post', event)" title="Create Post">
                    <i class="fas fa-paper-plane"></i>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('scheduled', event)" title="Scheduled & History">
                    <i class="fas fa-clock"></i>
                </a>
            </div>
            <div class="nav-item mt-auto">
                <a href="{{ url_for('logout') }}" class="nav-link" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </a>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Post Creation Section -->
        <div id="post-section" class="content-section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10 col-xl-8">
                        <div class="card fade-in-up">
                            <div class="card-header">
                                <h3 class="text-white">
                                    <i class="fas fa-paper-plane"></i> Create New Post
                                </h3>
                                <p class="text-white-50 mb-0 mt-2">Create and schedule posts with images and captions
                                </p>
                            </div>
                            <div class="card-body">
                                {% with messages = get_flashed_messages(with_categories=true) %}
                                {% if messages %}
                                {% for category, message in messages %}
                                <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show"
                                    role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                                {% endfor %}
                                {% endif %}
                                {% endwith %}

                                <form id="postForm" enctype="multipart/form-data">
                                    <!-- Account Selection Section -->
                                    <div class="form-section">
                                        <div class="section-title">
                                            <i class="fas fa-user-circle"></i>
                                            Select Account
                                        </div>
                                        <div id="selectedAccountContainer">
                                            <div class="alert alert-info">
                                                <i class="fas fa-info-circle me-2"></i>
                                                No account selected. Please select an account below.
                                            </div>
                                        </div>
                                        <div id="accountSelectorContent">
                                            <!-- Accounts will be loaded here -->
                                        </div>
                                    </div>

                                    <!-- Group Selection Section -->
                                    <div class="form-section">
                                        <div class="section-title">
                                            <i class="fas fa-users"></i>
                                            Select Groups
                                        </div>
                                        <div id="groupSelectorContent">
                                            <!-- Categories will be loaded here -->
                                            </div>
                                    </div>

                                    <!-- Poster Selection Section -->
                                    <div class="form-section">
                                        <div class="section-title">
                                            <i class="fas fa-image"></i>
                                            Select Poster
                                        </div>
                                        <div id="selectedPosterContainer">
                                            <div class="alert alert-info">
                                                <i class="fas fa-info-circle me-2"></i>
                                                Please select a poster to create your post. You can create posters in Poster Management.
                                        </div>
                                        </div>
                                        <div id="posterSelectorContent">
                                            <!-- Posters will be loaded here -->
                                        </div>
                                    </div>

                                    <!-- Date/Time Picker Section -->
                                    <div class="form-section">
                                        <div class="section-title">
                                            <i class="fas fa-calendar-alt"></i>
                                            Schedule Date & Time (optional)
                                        </div>
                                        <input type="datetime-local" id="scheduledDateTime" name="scheduledDateTime" class="form-control">
                                        <div class="help-text mt-2">
                                            <i class="fas fa-info-circle"></i>
                                            Leave empty to post immediately.
                                            </div>
                                    </div>

                                    <!-- Submit Section -->
                                    <div class="text-center">
                                        <button type="button" class="btn btn-primary btn-lg pulse" id="scheduleBtn">
                                            <i class="fas fa-clock me-2"></i>
                                            Schedule Post
                                        </button>
                                        <div class="loading text-center" id="loading">
                                            <div class="spinner-border text-primary mb-3" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <h5>Scheduling your post...</h5>
                                            <p class="text-muted">Please wait while we prepare your scheduled post</p>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Group Management Section -->
        <div id="groups-section" class="content-section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10 col-xl-8">
                        <div class="card fade-in-up">
                            <div class="card-header">
                                <h3 class="text-white">
                                    <i class="fas fa-users"></i> Group Management
                                </h3>
                                <p class="text-white-50 mb-0 mt-2">Organize and manage your Facebook groups</p>
                            </div>
                            <div class="card-body">
                                <!-- Categories Container -->
                                <div id="categoriesContainer">
                                    <!-- Categories will be loaded here -->
                                </div>

                                <!-- Add Category Button -->
                                <button type="button" class="btn add-category-btn" onclick="addCategory()">
                                    <i class="fas fa-plus me-2"></i>Add New Category
                                </button>


                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Poster Management Section -->
        <div id="posters-section" class="content-section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10 col-xl-8">
                        <div class="card fade-in-up">
                            <div class="card-header">
                                <h3 class="text-white">
                                    <i class="fas fa-image"></i> Poster Management
                                </h3>
                                <p class="text-white-50 mb-0 mt-2">Create and manage your saved posters</p>
                            </div>
                            <div class="card-body">
                                <!-- Posters Container -->
                                <div id="postersContainer">
                                    <!-- Posters will be loaded here -->
                                </div>

                                <!-- Add Poster Section -->
                                <div class="form-section">
                                    <div class="section-title">
                                        <i class="fas fa-plus-circle"></i>
                                        Create New Poster
                                    </div>
                                    <form id="posterForm">
                                    <div class="row">
                                            <div class="col-md-12">
                                            <div class="floating-label">
                                                    <input type="text" id="posterName" name="posterName" placeholder=" " required>
                                                    <label for="posterName">Poster Name</label>
                                            </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                            <div class="floating-label">
                                                    <textarea id="posterCaption" name="posterCaption" rows="4" placeholder=" " required></textarea>
                                                    <label for="posterCaption">Main Caption</label>
                                            </div>
                                        </div>
                                    </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="upload-area" onclick="document.getElementById('posterImages').click()">
                                                    <div class="upload-icon">
                                                        <i class="fas fa-cloud-upload-alt"></i>
                                                    </div>
                                                    <h5 class="mb-2">Upload Images</h5>
                                                    <p class="text-muted mb-0">Click to select or drag and drop images here</p>
                                                    <p class="text-muted small mt-2">Supports: PNG, JPG, JPEG, GIF, BMP</p>
                                                </div>
                                                <input type="file" class="d-none" id="posterImages" name="posterImages" multiple accept="image/*" onchange="handlePosterImageUpload()">
                                            </div>
                                        </div>
                                        <!-- Poster Image Previews -->
                                        <div id="posterImagePreviews" class="mt-4"></div>
                                    <div class="text-center mt-3">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-2"></i>Save Poster
                                        </button>
                                    </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Management Section -->
        <div id="accounts-section" class="content-section active">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10 col-xl-8">
                        <div class="card fade-in-up">
                            <div class="card-header">
                                <h3 class="text-white">
                                    <i class="fas fa-user-circle"></i> Account Management
                                </h3>
                                <p class="text-white-50 mb-0 mt-2">Manage your Facebook accounts</p>
                            </div>
                            <div class="card-body">
                                <!-- Accounts Container -->
                                <div id="accountsContainer">
                                    <!-- Accounts will be loaded here -->
                                </div>

                                <!-- Add Account Section -->
                                <div class="form-section">
                                    <div class="section-title">
                                        <i class="fas fa-plus-circle"></i>
                                        Add New Account
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="floating-label">
                                                <textarea id="newAccountCookies" rows="6" placeholder=" "
                                                    required></textarea>
                                                <label for="newAccountCookies">Facebook Cookies</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-center mt-3">
                                        <button type="button" class="btn btn-primary" onclick="fetchAndAddAccount()">
                                            <i class="fas fa-search me-2"></i>Fetch & Add Account
                                        </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <!-- Scheduled Posts & History Section -->
        <div id="scheduled-section" class="content-section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10 col-xl-8">
                        <div class="card fade-in-up">
                            <div class="card-header">
                                <h3 class="text-white">
                                    <i class="fas fa-clock"></i> Scheduled & History
                                </h3>
                                <p class="text-white-50 mb-0 mt-2">View your upcoming scheduled posts and post history</p>
                </div>
                            <div class="card-body">
                                <div id="scheduledPostsContainer">
                                    <!-- Scheduled and published posts will be loaded here -->
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>
        </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Navigation functions
        function showSection(section, event = null) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));

            // Show selected section
            document.getElementById(section + '-section').classList.add('active');
            
            // Only update nav-link if event is provided
            if (event && event.target) {
            event.target.classList.add('active');
            }

            // Load data for the section
            if (section === 'groups') {
                loadGroups();
            } else if (section === 'accounts') {
                loadAccounts();
            } else if (section === 'posters') {
                loadPosters();
            } else if (section === 'post') {
                loadPostSelectors();
            } else if (section === 'scheduled') {
                loadScheduledPosts();
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // Group Management Functions
        let categories = JSON.parse(localStorage.getItem('fbGroups') || '[]');
        let selectedGroups = [];

        // Account Management Functions
        let accounts = JSON.parse(localStorage.getItem('fbAccounts') || '[]');
        let selectedAccount = null;

        // Poster Management Functions
        let posters = [];
        let selectedPoster = null;

        function loadAccounts() {
            const container = document.getElementById('accountsContainer');
            
            if (!container) {
                return;
            }
            
            if (accounts.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No accounts added yet. Add your first Facebook account above.
                    </div>
                `;
                return;
            }

            const htmlContent = accounts.map((account, index) => `
                <div class="account-card">
                    <div class="account-header">
                        <img src="${account.profile_pic_url || 'https://via.placeholder.com/60x60/1877f2/ffffff?text=FB'}" 
                             alt="Profile" class="account-avatar" 
                             onerror="this.src='https://via.placeholder.com/60x60/1877f2/ffffff?text=FB'">
                        <div class="account-info">
                            <div class="account-name">${account.account_name}</div>
                            <div class="account-id">ID: ${account.user_id}</div>
                        </div>
                        <div class="account-actions">
                            <button class="remove-account-btn" onclick="removeAccount(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = htmlContent;
        }

        function loadGroups() {
            const container = document.getElementById('categoriesContainer');
            
            if (!container) {
                return;
            }
            
            if (categories.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No groups added yet. Click "Add New Category" to get started.
                    </div>
                `;
                return;
            }

            const htmlContent = categories.map((category, index) => `
                <div class="group-category" onclick="toggleGroupCategory(${index})">
                    <div class="category-header">
                        <div class="category-info">
                            <i class="fas fa-folder me-2"></i>
                        <span class="category-name">${category.name}</span>
                            <span class="category-count">(${category.groups.length} groups)</span>
                        </div>
                        <div class="category-actions">
                            <button class="btn btn-outline-danger btn-sm" onclick="removeCategory(${index}); event.stopPropagation();">
                                <i class="fas fa-trash"></i>
                            </button>
                            <div class="category-arrow">
                                <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                    </div>
                    <div class="category-content">
                    <div class="group-list">
                        ${category.groups.map((group, groupIndex) => `
                            <div class="group-tag">
                                    <img src="${group.image_url || 'https://via.placeholder.com/48x48/1877f2/ffffff?text=G'}" 
                                         alt="Group" class="group-avatar" 
                                         onerror="this.src='https://via.placeholder.com/48x48/1877f2/ffffff?text=G'">
                                    <div class="group-info">
                                        <span class="group-name">${group.name}</span>
                                <span class="member-count">(${group.member_count})</span>
                                    </div>
                                    <button class="remove-group" onclick="removeGroupFromCategory(${index}, ${groupIndex}); event.stopPropagation();">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `).join('')}
                        </div>
                        
                        <!-- Add Group Input for this category -->
                        <div class="add-group-section" onclick="event.stopPropagation();">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="floating-label">
                                        <input type="text" 
                                               class="form-control" 
                                               placeholder=" " 
                                               id="groupInput-${index}"
                                               onkeypress="handleGroupInputKeypress(event, ${index})">
                                        <label for="groupInput-${index}">Enter Facebook Group ID</label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <button type="button" 
                                            class="btn btn-primary w-100" 
                                            onclick="fetchAndAddGroupToCategory(${index})">
                                        <i class="fas fa-plus me-2"></i>Add Group
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML = htmlContent;
            // Update category dropdown
            updateCategoryDropdown();
        }

        function updateCategoryDropdown() {
            const dropdown = document.getElementById('newGroupCategory');
            if (!dropdown) {
                return;
            }
            
            dropdown.innerHTML = '<option value="">Select Category</option>';
            categories.forEach((category, index) => {
                dropdown.innerHTML += `<option value="${index}">${category.name}</option>`;
            });
        }

        function fetchAndAddGroupToCategory(categoryIndex) {
            const groupId = document.getElementById(`groupInput-${categoryIndex}`).value.trim();

            if (!groupId) {
                alert('Please enter a group ID');
                return;
            }

            if (!selectedAccount) {
                alert('Please select an account first');
                return;
            }

            // Show loading
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Fetching...';
            button.disabled = true;

            fetch('/fetch_group_info', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    group_id: groupId,
                    cookies: selectedAccount.cookies
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Save group to MongoDB
                        return saveGroupToMongoDB({
                            group_name: data.group_name,
                            group_id: data.group_id,
                            member_count: data.member_count,
                            group_image_url: data.group_image_url,
                            category_index: categoryIndex
                        });
                    } else {
                        throw new Error(data.error);
                    }
                })
                .then(saveResult => {
                    if (saveResult.success) {
                        // Reload data from MongoDB
                        loadUserDataFromMongoDB();

                        // Clear form
                        document.getElementById(`groupInput-${categoryIndex}`).value = '';

                        // Show success message
                        showFloatingNotification('Group added successfully!', 'success');
                        } else {
                        throw new Error(saveResult.error);
                    }
                })
                .catch(error => {
                    showFloatingNotification('Error: ' + error.message, 'error');
                })
                .finally(() => {
                    // Reset button
                    button.innerHTML = originalText;
                    button.disabled = false;
                });
        }

        function handleGroupInputKeypress(event, categoryIndex) {
            if (event.key === 'Enter') {
                fetchAndAddGroupToCategory(categoryIndex);
            }
        }

        function addCategory() {
            const categoryName = prompt('Enter category name:');
            if (categoryName && categoryName.trim()) {
                categories.push({
                    name: categoryName.trim(),
                    groups: []
                });
                saveCompleteUserData().then(() => {
                loadGroups();
                });
            }
        }

        function removeCategory(index) {
            if (confirm('Are you sure you want to remove this category?')) {
                categories.splice(index, 1);
                saveCompleteUserData().then(() => {
                loadGroups();
                });
            }
        }

        function removeGroupFromCategory(categoryIndex, groupIndex) {
            categories[categoryIndex].groups.splice(groupIndex, 1);
            saveCompleteUserData().then(() => {
            loadGroups();
            });
        }





        function loadCategorySelector() {
            const container = document.getElementById('groupSelectorContent');
            if (categories.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        No categories available. Please add categories and groups in Group Management first.
                    </div>
                `;
                return;
            }

            container.innerHTML = categories.map((category, categoryIndex) => `
                <div class="category-selection-card" onclick="toggleCategorySelection(${categoryIndex})">
                    <div class="category-selection-header">
                        <div class="category-selection-checkbox">
                        <input class="form-check-input" type="checkbox" 
                               value="${categoryIndex}" 
                                   id="category-${categoryIndex}"
                                   onclick="event.stopPropagation()"
                                   onchange="updateSelectedGroupsDisplay()">
                            <label class="form-check-label" for="category-${categoryIndex}">
                                <i class="fas fa-folder me-2"></i>
                                <span class="category-title">${category.name}</span>
                                <span class="category-count">(${category.groups.length} groups)</span>
                        </label>
                    </div>
                        <div class="category-selection-arrow">
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                    <div class="category-selection-content">
                        <div class="group-list">
                            ${category.groups.map(group => `
                                <div class="group-tag">
                                    <img src="${group.image_url || 'https://via.placeholder.com/48x48/1877f2/ffffff?text=G'}" 
                                         alt="Group" class="group-avatar" 
                                         onerror="this.src='https://via.placeholder.com/48x48/1877f2/ffffff?text=G'">
                                    <div class="group-info">
                                        <span class="group-name">${group.name}</span>
                                        <span class="member-count">(${group.member_count})</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleCategorySelection(categoryIndex) {
            const card = document.querySelector(`#category-${categoryIndex}`).closest('.category-selection-card');
            const checkbox = document.querySelector(`#category-${categoryIndex}`);
            
            // Toggle the card selection
            card.classList.toggle('selected');
            
            // If card is selected, check the checkbox
            if (card.classList.contains('selected')) {
                checkbox.checked = true;
            } else {
                checkbox.checked = false;
            }
            
            // Update the selected groups display
            updateSelectedGroupsDisplay();
        }

        function toggleGroupCategory(categoryIndex) {
            const category = document.querySelector(`.group-category:nth-child(${categoryIndex + 1})`);
            category.classList.toggle('expanded');
        }

        function confirmCategorySelection() {
            selectedGroups = [];
            const checkboxes = document.querySelectorAll('#groupSelectorContent input[type="checkbox"]:checked');

            checkboxes.forEach(checkbox => {
                const categoryIndex = parseInt(checkbox.value);
                selectedGroups.push(...categories[categoryIndex].groups);
            });

            updateSelectedGroupsDisplay();
        }

        function updateSelectedGroupsDisplay() {
            // Get all checked category checkboxes
            const checkboxes = document.querySelectorAll('#groupSelectorContent input[type="checkbox"]:checked');
            selectedGroups = [];
            
            checkboxes.forEach(checkbox => {
                const categoryIndex = parseInt(checkbox.value);
                if (categories[categoryIndex] && categories[categoryIndex].groups) {
                    selectedGroups.push(...categories[categoryIndex].groups);
                }
            });
        }

        function fetchAndAddAccount() {
            const cookies = document.getElementById('newAccountCookies').value;

            if (!cookies) {
                alert('Please enter Facebook cookies');
                return;
            }

            // Show loading
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Fetching...';
            button.disabled = true;

            fetch('/fetch_account_info', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    cookies: cookies
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Save account to MongoDB
                        return saveAccountToMongoDB({
                            account_name: data.account_name,
                            user_id: data.user_id,
                            profile_pic_url: data.profile_pic_url,
                            cookies: data.cookies
                        });
                    } else {
                        throw new Error(data.error);
                    }
                })
                .then(saveResult => {
                    if (saveResult.success) {
                        // Reload data from MongoDB
                        loadUserDataFromMongoDB();

                        // Clear form
                        document.getElementById('newAccountCookies').value = '';

                        // Show success message
                        showFloatingNotification('Account added successfully!', 'success');
                        } else {
                        throw new Error(saveResult.error);
                    }
                })
                .catch(error => {
                    showFloatingNotification('Error: ' + error.message, 'error');
                })
                .finally(() => {
                    // Reset button
                    button.innerHTML = originalText;
                    button.disabled = false;
                });
        }

        function selectAccount(index) {
            // Select the clicked account
            selectedAccount = accounts[index];
            updateSelectedAccountDisplay();
        }

        function removeAccount(index) {
            if (confirm('Are you sure you want to remove this account?')) {
                accounts.splice(index, 1);
                // If we removed the selected account, clear selection
                if (selectedAccount && accounts.length === 0) {
                    selectedAccount = null;
                }
                saveCompleteUserData().then(() => {
                loadAccounts();
                updateSelectedAccountDisplay();
                });
            }
        }





        function loadAccountSelector() {
            const container = document.getElementById('accountSelectorContent');
            if (accounts.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        No accounts available. Please add accounts in Account Management first.
                    </div>
                `;
                return;
            }

            container.innerHTML = accounts.map((account, index) => `
                <div class="account-card mb-3 ${selectedAccount === account ? 'selected' : ''}" onclick="selectAccountFromModal(${index})">
                    <div class="account-header">
                        <img src="${account.profile_pic_url || 'https://via.placeholder.com/60x60/1877f2/ffffff?text=FB'}" 
                             alt="Profile" class="account-avatar" 
                             onerror="this.src='https://via.placeholder.com/60x60/1877f2/ffffff?text=FB'">
                        <div class="account-info">
                            <div class="account-name">${account.account_name}</div>
                            <div class="account-id">ID: ${account.user_id}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadPostSelectors() {
            loadAccountSelector();
            loadCategorySelector();
            loadPosterSelector();
        }

        function selectAccountFromModal(index) {
            // Select the clicked account
            selectedAccount = accounts[index];
            loadAccountSelector();
            updateSelectedAccountDisplay();
        }



        function updateSelectedAccountDisplay() {
            const container = document.getElementById('selectedAccountContainer');

            if (!selectedAccount) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No account selected. Please select an account above.
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="alert alert-success">
                    <i class="fas fa-check-circle me-2"></i>
                    Account selected: <strong>${selectedAccount.account_name}</strong>
                </div>
            `;
        }

        // Existing functions...
        function handleImageUpload() {
            // This function is no longer needed since we only use posters
            console.log('Manual image upload is disabled. Please use posters instead.');
        }

        // Drag and drop functionality
        const uploadArea = document.querySelector('.upload-area');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#42a5f5';
            uploadArea.style.background = 'linear-gradient(135deg, #e7f3ff 0%, #f0f2f5 100%)';
        });

        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#1877f2';
            uploadArea.style.background = 'linear-gradient(135deg, #f0f2f5 0%, #e4e6eb 100%)';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#1877f2';
            uploadArea.style.background = 'linear-gradient(135deg, #f0f2f5 0%, #e4e6eb 100%)';

            const files = e.dataTransfer.files;
            document.getElementById('images').files = files;
            handleImageUpload();
        });

        // Add poster form submission handler
        document.getElementById('posterForm').addEventListener('submit', function(e) {
            e.preventDefault();
            savePoster();
        });

        // Add schedule button event handler
        document.getElementById('scheduleBtn').addEventListener('click', function(e) {
            e.preventDefault();
            schedulePost();
        });

        // Prevent form submission since we only use the schedule button
        document.getElementById('postForm').addEventListener('submit', function(e) {
            e.preventDefault();
        });



        // Add floating label functionality
        document.querySelectorAll('.floating-label input, .floating-label textarea').forEach(element => {
            element.addEventListener('focus', function () {
                this.parentElement.classList.add('focused');
            });

            element.addEventListener('blur', function () {
                if (!this.value) {
                    this.parentElement.classList.remove('focused');
                }
            });
        });

        // Floating notification function
        function showFloatingNotification(message, type = 'success', duration = 2000) {
            const notification = document.createElement('div');
            notification.className = `floating-notification alert alert-${type} alert-dismissible fade show`;
            notification.innerHTML = `
                <strong><i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-2"></i></strong>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after duration
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 500);
            }, duration);
        }

        // MongoDB Functions
        function loadUserDataFromMongoDB() {
            fetch('/get_user_data', {
                method: 'GET',
                credentials: 'same-origin',
                headers: {
                    'Cache-Control': 'no-cache',
                    'Pragma': 'no-cache'
                }
            })
                .then(response => {
                    if (!response.ok) {
                        if (response.status === 401 || response.status === 403) {
                            window.location.href = '/login';
                            return;
                        }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data) {
                        return;
                    }
                    
                    if (data.success) {
                        accounts = data.accounts || [];
                        categories = data.groups || [];
                        posters = data.posters || [];
                        
                        // No auto-creation of categories - users must create them manually
                        
                        // Check if containers exist before calling functions
                        const accountsContainer = document.getElementById('accountsContainer');
                        const categoriesContainer = document.getElementById('categoriesContainer');
                        const postersContainer = document.getElementById('postersContainer');
                        
                        if (accountsContainer) {
        loadAccounts();
                        }
                        
                        if (categoriesContainer) {
                            loadGroups();
                        }
                        
                        if (postersContainer) {
                            loadPosters();
                        }
                        
                        loadPostSelectors();
                    } else {
                        showFloatingNotification('Failed to load user data: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    showFloatingNotification('Error loading user data: ' + error.message, 'error');
                });
        }

        function saveAccountToMongoDB(accountData) {
            return fetch('/save_account', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(accountData)
            })
            .then(response => response.json());
        }

        function saveGroupToMongoDB(groupData) {
            return fetch('/save_group', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(groupData)
            })
            .then(response => response.json());
        }

        function saveCompleteUserData() {
            return fetch('/save_user_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    accounts: accounts,
                    groups: categories
                })
            })
            .then(response => response.json());
        }

        // Initialize
        showSection('accounts');
        
        // Set minimum date for datetime picker
        function setMinDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const minDateTime = `${year}-${month}-${day}T${hours}:${minutes}`;
            
            const dateTimeInput = document.getElementById('scheduledDateTime');
            if (dateTimeInput) {
                dateTimeInput.min = minDateTime;
            }
        }
        
        // Wait for DOM to be fully loaded before making the request
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                loadUserDataFromMongoDB();
                setMinDateTime();
            });
        } else {
            loadUserDataFromMongoDB();
            setMinDateTime();
        }
        
        // Also reload data when page becomes visible (handles refresh scenarios)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                loadUserDataFromMongoDB();
            }
        });

        function loadPosters() {
            const container = document.getElementById('postersContainer');
            
            if (!container) {
                return;
            }
            
            if (posters.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No posters created yet. Create your first poster below.
                    </div>
                `;
                return;
            }

            const htmlContent = posters.map((poster, index) => `
                <div class="poster-card">
                    <div class="poster-header">
                        <div class="poster-info">
                            <div class="poster-name">${poster.name}</div>
                            <div class="poster-caption">${poster.caption.substring(0, 100)}${poster.caption.length > 100 ? '...' : ''}</div>
                        </div>
                        <div class="poster-actions">
                            <button class="remove-poster-btn" onclick="removePoster(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="poster-images">
                        ${poster.images.map((image, imgIndex) => `
                            <div class="poster-image-item">
                                <img src="${image.data}" alt="Poster Image" class="poster-thumbnail">
                                <div class="image-caption">${image.caption || 'No caption'}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = htmlContent;
        }

        function handlePosterImageUpload() {
            const fileInput = document.getElementById('posterImages');
            const previewContainer = document.getElementById('posterImagePreviews');

            previewContainer.innerHTML = '';

            if (fileInput.files.length > 0) {
                for (let i = 0; i < fileInput.files.length; i++) {
                    const file = fileInput.files[i];
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        const previewDiv = document.createElement('div');
                        previewDiv.className = 'image-preview-container fade-in-up';
                        previewDiv.innerHTML = `
                            <div class="row align-items-center">
                                <div class="col-md-3 text-center">
                                    <img src="${e.target.result}" class="image-preview" alt="Preview">
                                </div>
                                <div class="col-md-9">
                                    <label class="form-label">Caption for ${file.name} (Optional)</label>
                                    <input type="text" class="form-control poster-image-caption" 
                                           placeholder="Enter a caption for this image...">
                                    <div class="help-text mt-2">
                                        <i class="fas fa-info-circle"></i>
                                        Add a specific caption for this image
                                    </div>
                                </div>
                            </div>
                        `;
                        previewContainer.appendChild(previewDiv);
                    };

                    reader.readAsDataURL(file);
                }
            }
        }

        function savePoster() {
            const name = document.getElementById('posterName').value.trim();
            const caption = document.getElementById('posterCaption').value.trim();
            const fileInput = document.getElementById('posterImages');
            const captionInputs = document.querySelectorAll('.poster-image-caption');

            if (!name || !caption || fileInput.files.length === 0) {
                showFloatingNotification('Please fill in all required fields and upload at least one image.', 'error');
                return;
            }

            // Convert files to base64 and collect captions
            const imagePromises = [];
            for (let i = 0; i < fileInput.files.length; i++) {
                const file = fileInput.files[i];
                const caption = captionInputs[i] ? captionInputs[i].value.trim() : '';
                
                const promise = new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        resolve({
                            name: file.name,
                            caption: caption,
                            data: e.target.result
                        });
                    };
                    reader.readAsDataURL(file);
                });
                imagePromises.push(promise);
            }

            // Wait for all images to be converted
            Promise.all(imagePromises)
                .then(images => {
                    // Save poster to MongoDB
                    const posterData = {
                        name: name,
                        caption: caption,
                        images: images
                    };

                    return savePosterToMongoDB(posterData);
                })
                .then(result => {
                    if (result.success) {
                        // Reload data from MongoDB
                        loadUserDataFromMongoDB();
                        
                        // Clear form
                        document.getElementById('posterForm').reset();
                        document.getElementById('posterImagePreviews').innerHTML = '';

                        showFloatingNotification('Poster saved successfully!', 'success');
                    } else {
                        showFloatingNotification('Error: ' + result.error, 'error');
                    }
                })
                .catch(error => {
                    showFloatingNotification('Error saving poster: ' + error.message, 'error');
                });
        }

        function removePoster(index) {
            if (confirm('Are you sure you want to remove this poster?')) {
                // Check if we're removing the currently selected poster
                const posterToRemove = posters[index];
                if (selectedPoster === posterToRemove) {
                    selectedPoster = null;
                }
                
                posters.splice(index, 1);
                
                // Save updated posters to MongoDB
                const userData = {
                    accounts: accounts,
                    groups: categories,
                    posters: posters
                };
                
                fetch('/save_user_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        loadPosters();
                        updateSelectedPosterDisplay();
                        showFloatingNotification('Poster removed successfully!', 'success');
                    } else {
                        showFloatingNotification('Error removing poster: ' + result.error, 'error');
                    }
                })
                .catch(error => {
                    showFloatingNotification('Error removing poster: ' + error.message, 'error');
                });
            }
        }

        function selectPosterFromModal(index) {
            selectedPoster = posters[index];
            loadPosterSelector();
            updateSelectedPosterDisplay();
        }

        function updateSelectedPosterDisplay() {
            const container = document.getElementById('selectedPosterContainer');

            if (!selectedPoster) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Please select a poster to create your post. You can create posters in Poster Management.
                    </div>
                `;
                return;
            }

            // Populate form with poster data
            document.getElementById('main_caption').value = selectedPoster.caption;
            
            // Create image previews from poster data
            const imagePreviewsContainer = document.getElementById('imagePreviews');
            imagePreviewsContainer.innerHTML = '';
            
            selectedPoster.images.forEach((image, index) => {
                const previewDiv = document.createElement('div');
                previewDiv.className = 'image-preview-container fade-in-up';
                previewDiv.innerHTML = `
                    <div class="row align-items-center">
                        <div class="col-md-3 text-center">
                            <img src="${image.data}" class="image-preview" alt="Preview">
                        </div>
                        <div class="col-md-9">
                            <label class="form-label">Caption for ${image.name}</label>
                            <input type="text" class="form-control" name="image_captions" 
                                   value="${image.caption || ''}" readonly>
                            <div class="help-text mt-2">
                                <i class="fas fa-info-circle"></i>
                                Caption from selected poster
                            </div>
                        </div>
                    </div>
                `;
                imagePreviewsContainer.appendChild(previewDiv);
            });
        }



        function loadPosterSelector() {
            const container = document.getElementById('posterSelectorContent');
            if (posters.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        No posters available. Please create posters in Poster Management first.
                    </div>
                `;
                return;
            }

            container.innerHTML = posters.map((poster, index) => `
                <div class="poster-card mb-3 ${selectedPoster === poster ? 'selected' : ''}" onclick="selectPosterFromModal(${index})">
                    <div class="poster-header">
                        <div class="poster-info">
                            <div class="poster-name">${poster.name}</div>
                            <div class="poster-caption">${poster.caption.substring(0, 100)}${poster.caption.length > 100 ? '...' : ''}</div>
                        </div>
                    </div>
                    <div class="poster-images">
                        ${poster.images.map(image => `
                            <div class="poster-image-item">
                                <img src="${image.data}" alt="Poster Image" class="poster-thumbnail">
                                <div class="image-caption">${image.caption || 'No caption'}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function savePosterToMongoDB(posterData) {
            return fetch('/save_poster', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(posterData)
            })
            .then(response => response.json());
        }

        function schedulePost() {
            if (!selectedAccount) {
                showFloatingNotification('Please select an account before scheduling.', 'error');
                return;
            }

            // Update selected groups from checkboxes before validation
            updateSelectedGroupsDisplay();

            if (selectedGroups.length === 0) {
                showFloatingNotification('Please select at least one group before scheduling.', 'error');
                return;
            }

            if (!selectedPoster) {
                showFloatingNotification('Please select a poster before scheduling.', 'error');
                return;
            }

            const scheduledDateTime = document.getElementById('scheduledDateTime').value;
            if (!scheduledDateTime) {
                showFloatingNotification('Please select a date and time for scheduling.', 'error');
                return;
            }

            const scheduledTime = new Date(scheduledDateTime);
            if (scheduledTime <= new Date()) {
                showFloatingNotification('Scheduled time must be in the future.', 'error');
                return;
            }

            const scheduleBtn = document.getElementById('scheduleBtn');
            const loading = document.getElementById('loading');

            // Show loading
            scheduleBtn.style.display = 'none';
            loading.style.display = 'block';

            // Convert base64 images to blobs first
            const imagePromises = selectedPoster.images.map(image => {
                return fetch(image.data)
                    .then(res => res.blob())
                    .then(blob => ({
                        blob: blob,
                        name: image.name,
                        caption: image.caption || ''
                    }));
            });

            // Wait for all images to be converted
            Promise.all(imagePromises)
                .then(imageBlobs => {
                    // Prepare scheduled post data
                    const scheduledPostData = {
                        group_ids: selectedGroups.map(group => group.id),
                        main_caption: selectedPoster.caption,
                        cookies: selectedAccount.cookies,
                        scheduled_time: scheduledDateTime, // Send local time, backend will convert to UTC
                        poster_name: selectedPoster.name,
                        account_name: selectedAccount.account_name,
                        groups: selectedGroups.map(group => group.name),
                        images: selectedPoster.images // Use the original base64 data
                    };

                    // Submit the scheduled post
                    return fetch('/schedule_post', {
                method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(scheduledPostData)
                    });
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showFloatingNotification(data.message, 'success');

                        // Reset form
                        document.getElementById('scheduledDateTime').value = '';
                        selectedGroups = [];
                        selectedPoster = null;
                        updateSelectedGroupsDisplay();
                        updateSelectedPosterDisplay();
                    } else {
                        showFloatingNotification(data.error, 'error');
                    }
                })
                .catch(error => {
                    showFloatingNotification(`An unexpected error occurred: ${error.message}`, 'error');
                })
                .finally(() => {
                    // Hide loading
                    scheduleBtn.style.display = 'block';
                    loading.style.display = 'none';
                });
        }

        // Scheduled Posts Functions
        function loadScheduledPosts() {
            fetch('/get_scheduled_posts', {
                method: 'GET',
                credentials: 'same-origin',
                headers: {
                    'Cache-Control': 'no-cache',
                    'Pragma': 'no-cache'
                }
            })
                .then(response => {
                    if (!response.ok) {
                        if (response.status === 401 || response.status === 403) {
                            window.location.href = '/login';
                            return;
                        }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data) {
                        return;
                    }
                    
                    if (data.success) {
                        displayScheduledPosts(data.posts || []);
                    } else {
                        showFloatingNotification('Failed to load scheduled posts: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    showFloatingNotification('Error loading scheduled posts: ' + error.message, 'error');
                });
        }

        // Debug function to show time conversion details
        function debugTimeConversion(utcTimeString, localTime) {
            console.log('🔍 Time Debug:');
            console.log('  UTC string from backend:', utcTimeString);
            console.log('  Parsed as UTC:', new Date(utcTimeString + 'Z'));
            console.log('  Displayed as local:', localTime);
            console.log('  Local timezone offset:', new Date().getTimezoneOffset(), 'minutes');
        }

        function displayScheduledPosts(posts) {
            const container = document.getElementById('scheduledPostsContainer');
            
            if (!container) {
                return;
            }
            
            if (posts.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        No scheduled or published posts yet. Schedule your first post in the Create Post section.
                    </div>
                `;
                return;
            }

            const htmlContent = posts.map((post, index) => {
                // Parse UTC times and convert to local time for display
                const scheduledTime = new Date(post.scheduled_time + 'Z'); // Ensure UTC parsing
                const createdTime = new Date(post.created_at + 'Z'); // Ensure UTC parsing
                
                // Debug time conversion for the first post
                if (index === 0) {
                    debugTimeConversion(post.scheduled_time, scheduledTime);
                }
                
                const status = post.status;
                
                let statusBadge = '';
                let statusClass = '';
                
                switch (status) {
                    case 'scheduled':
                        statusBadge = '<span class="badge bg-warning">Scheduled</span>';
                        statusClass = 'scheduled';
                        break;
                    case 'published':
                        statusBadge = '<span class="badge bg-success">Published</span>';
                        statusClass = 'published';
                        break;
                    case 'partial':
                        statusBadge = '<span class="badge bg-warning">Partial</span>';
                        statusClass = 'partial';
                        break;
                    case 'failed':
                        statusBadge = '<span class="badge bg-danger">Failed</span>';
                        statusClass = 'failed';
                        break;
                    default:
                        statusBadge = '<span class="badge bg-secondary">Unknown</span>';
                        statusClass = 'unknown';
                }
                
                let resultInfo = '';
                if (post.result) {
                    if (post.result.successful_posts !== undefined) {
                        resultInfo = `
                            <div class="mt-2">
                                <small class="text-muted">
                                    <i class="fas fa-chart-bar me-1"></i>
                                    ${post.result.successful_posts} of ${post.result.total_groups} groups successful
                                </small>
                            </div>
                        `;
                    } else if (post.result.error) {
                        resultInfo = `
                            <div class="mt-2">
                                <small class="text-danger">
                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                    ${post.result.error}
                                </small>
                            </div>
                        `;
                    }
                }
                
                let deleteButton = '';
                if (status === 'scheduled') {
                    deleteButton = `
                        <button class="btn btn-outline-danger btn-sm" onclick="deleteScheduledPost('${post._id}')">
                            <i class="fas fa-trash"></i> Cancel
                        </button>
                    `;
                }
                
                return `
                    <div class="card mb-3 ${statusClass}-post">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <div class="d-flex align-items-center mb-2">
                                        <h6 class="card-title mb-0 me-2">${post.poster_name}</h6>
                                        ${statusBadge}
                                    </div>
                                    <p class="card-text text-muted mb-2">
                                        <i class="fas fa-user me-1"></i> ${post.account_name}
                                    </p>
                                    <p class="card-text text-muted mb-2">
                                        <i class="fas fa-users me-1"></i> ${post.groups ? post.groups.length : 0} groups
                                    </p>
                                    <p class="card-text text-muted mb-2">
                                        <i class="fas fa-clock me-1"></i> Scheduled for: ${scheduledTime.toLocaleString('en-US', { timeZoneName: 'short' })}
                                    </p>
                                    <p class="card-text text-muted mb-2">
                                        <i class="fas fa-calendar-plus me-1"></i> Created: ${createdTime.toLocaleString('en-US', { timeZoneName: 'short' })}
                                    </p>
                                    ${resultInfo}
                                </div>
                                <div class="ms-3">
                                    ${deleteButton}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = htmlContent;
        }

        function deleteScheduledPost(postId) {
            if (!confirm('Are you sure you want to cancel this scheduled post?')) {
                return;
            }
            
            fetch('/delete_scheduled_post', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    post_id: postId
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showFloatingNotification('Scheduled post cancelled successfully!', 'success');
                        loadScheduledPosts(); // Reload the list
                    } else {
                        showFloatingNotification('Error: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    showFloatingNotification('Error cancelling post: ' + error.message, 'error');
                });
        }
    </script>
</body>
</html>